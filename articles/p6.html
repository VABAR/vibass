<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Practical 6: Linear models • vibass</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Practical 6: Linear models">
<meta property="og:description" content="vibass">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vibass</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.16</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/p1.html">Practical 1: Binary data</a>
    </li>
    <li>
      <a href="../articles/p2.html">Practical 2: Inference with simulated samples</a>
    </li>
    <li>
      <a href="../articles/p3.html">Practical 3: Count data</a>
    </li>
    <li>
      <a href="../articles/p4.html">Practical 4: Normal data</a>
    </li>
    <li>
      <a href="../articles/p5.html">Practical 5: Numerical approaches</a>
    </li>
    <li>
      <a href="../articles/p5_solutions.html">Solutions 5: Numerical approaches</a>
    </li>
    <li>
      <a href="../articles/p6.html">Practical 6: Linear models</a>
    </li>
    <li>
      <a href="../articles/p6_solutions.html">Solutions 6: Linear models</a>
    </li>
    <li>
      <a href="../articles/p7.html">Practical 7: Generalized linear models</a>
    </li>
    <li>
      <a href="../articles/p7_solutions.html">Solutions 7: Generalized linear models</a>
    </li>
    <li>
      <a href="../articles/p8.html">Practical 8: Bayesian hierachical models</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="p6_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Practical 6: Linear models</h1>
                        <h4 class="author">VIBASS4</h4>
            
            <h4 class="date">July 2021</h4>
      
      
      <div class="hidden name"><code>p6.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>In the previous practical, you implemented the Importance sampling (IS) and Metropolis-Hastings (M-H) algorithms using examples on binomial and Poisson data. In this practical, an example on Normal data will be used to estimate the mean and precision of the Normal distribution. Please refer to the previous practical if you need to refresh yuor memory on the details of the IS and M-H algorithms.</p>
</div>
<div id="example-normal-normal-gamma-model" class="section level1">
<h1 class="hasAnchor">
<a href="#example-normal-normal-gamma-model" class="anchor"></a>Example: Normal-Normal-Gamma Model</h1>
<p>In this example the heights data set will be considered. The heights of the participants of VIBASS have been collected and the aim is to make inference about the average. In this case, the data follow a Normal distribution with mean <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma^2\)</span>. The prior on <span class="math inline">\(\mu\)</span> is a Normal with known mean and precision and the prior on <span class="math inline">\(\tau\)</span> is a gamma distribution with known parameters.</p>
<p>This model can be stated as:</p>
<p><span class="math display">\[
\begin{array}{rcl}
y_i &amp; \sim &amp; N(\mu, \tau)\\
\mu &amp; \sim &amp; N(\mu_{\mu}, \tau_{\mu})\\
\tau &amp; \sim &amp; Ga(a, b)
\end{array}
\]</span></p>
<p><strong>Note that now the Normal distribution is expressed using precision rather than variance.</strong></p>
<p>The parameters for the priors are as follows. For the prior on <span class="math inline">\(\mu\)</span>, we will use a Gaussian distribution with mean <span class="math inline">\(\mu_{\mu} = 0\)</span> and precision <span class="math inline">\(\tau_{\mu} = 0.001\)</span>. For the prior on <span class="math inline">\(\tau\)</span>, a Gamma with parameters <span class="math inline">\(0.01\)</span> and <span class="math inline">\(0.01\)</span> will be used, as this provides a vague prior due to a small precision (and hence a large variance).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>height <span class="op">=</span> 
<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.73</span>, <span class="fl">1.65</span>, <span class="fl">1.65</span>, <span class="fl">1.76</span>, <span class="fl">1.65</span>, <span class="fl">1.63</span>, <span class="fl">1.70</span>, <span class="fl">1.58</span>, <span class="fl">1.57</span>, <span class="fl">1.65</span>, <span class="fl">1.74</span>, <span class="fl">1.68</span>, <span class="fl">1.67</span>, <span class="fl">1.58</span>, <span class="fl">1.66</span>, <span class="fl">1.92</span>, <span class="fl">1.82</span>, <span class="fl">1.69</span>, <span class="fl">1.75</span>, <span class="fl">1.72</span>, <span class="fl">1.71</span>, <span class="fl">1.73</span>, <span class="fl">1.69</span>, <span class="fl">1.70</span>, <span class="fl">1.78</span>, <span class="fl">1.88</span>, <span class="fl">1.82</span>, <span class="fl">1.86</span>, <span class="fl">1.65</span><span class="op">)</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">height</span></code></pre></div>
<p>Note that these heights correspond to those available in previous practicals, with the first 15 values corresponding to female VIBASS participants and the following 14 to male VIBASS participants.</p>
<div id="importance-sampling" class="section level2">
<h2 class="hasAnchor">
<a href="#importance-sampling" class="anchor"></a>Importance sampling</h2>
<p>In this example we have to make inference on two parameters, i.e. <span class="math inline">\(\theta = (\mu, \tau)\)</span>. Hence, the sampling distribution will be a bivariate distribution. In fact, we will be sampling <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\tau\)</span> independently of each other. Values of <span class="math inline">\(\mu\)</span> will be sampled using a log-Normal distribution centered at 0 and with standard deviation 0.5, and values of <span class="math inline">\(\tau\)</span> will be proposed using a log-Normal distribution with mean 0 and standard deviation 1.25.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># We increase the number of simulations in this example</span>
<span class="va">n_simulations</span> <span class="op">&lt;-</span> <span class="fl">40000</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span>
<span class="va">theta_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html">rlnorm</a></span><span class="op">(</span><span class="va">n_simulations</span>, <span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html">rlnorm</a></span><span class="op">(</span><span class="va">n_simulations</span>, <span class="fl">0</span>, <span class="fl">1.25</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Next, importance weights are computed. Note that now the density of the bivariate sampling distribution is the product of the two univariate sampling distributions (or the sum on the log scale).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Log-Likelihood (for each value of theta_sim)</span>
<span class="co"># NOTE: 'apply' is used now as 'theta_sim' is a matrix</span>
<span class="va">loglik_biv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">theta_sim</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">THETA</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">height</span>, <span class="va">THETA</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">THETA</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="co"># Log-weights: log-lik + log-prior - log-sampling_distr</span>
<span class="va">log_ww</span> <span class="op">&lt;-</span> <span class="va">loglik_biv</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">theta_sim</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">dgamma</a></span><span class="op">(</span><span class="va">theta_sim</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, <span class="fl">0.01</span>, <span class="fl">0.01</span><span class="op">)</span>
<span class="va">log_ww</span> <span class="op">&lt;-</span> <span class="va">log_ww</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html">dlnorm</a></span><span class="op">(</span><span class="va">theta_sim</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html">dlnorm</a></span><span class="op">(</span><span class="va">theta_sim</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">1.25</span><span class="op">)</span>
  

<span class="co"># Re-scale weights to sum to one</span>
<span class="va">log_ww</span> <span class="op">&lt;-</span> <span class="va">log_ww</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">log_ww</span><span class="op">)</span>
<span class="va">ww</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">log_ww</span><span class="op">)</span>
<span class="va">ww</span> <span class="op">&lt;-</span> <span class="va">ww</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">ww</span><span class="op">)</span></code></pre></div>
<p>Importance weights can be summarized using a histogram (see below). The distribution of weights shows that most samples are far from the regions of high posterior density.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">ww</span>, xlab <span class="op">=</span> <span class="st">"Importance weights"</span><span class="op">)</span></code></pre></div>
<p><img src="p6_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>The posterior mean and variance can be computed as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Posterior mean (mu)</span>
<span class="va">post_mean_mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">theta_sim</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">ww</span><span class="op">)</span>
<span class="va">post_mean_mu</span>
<span class="co">#&gt; [1] 1.69772</span>

<span class="co"># Posterior variance (mu)</span>
<span class="va">post_var_mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">theta_sim</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="va">ww</span><span class="op">)</span><span class="op">-</span> <span class="va">post_mean_mu</span><span class="op">^</span><span class="fl">2</span>
<span class="va">post_var_mu</span>
<span class="co">#&gt; [1] 0.000118331</span>

<span class="co"># Posterior mean (tau)</span>
<span class="va">post_mean_tau</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">theta_sim</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">ww</span><span class="op">)</span>
<span class="va">post_mean_tau</span> 
<span class="co">#&gt; [1] 56.4975</span>

<span class="co"># Posterior variance (tau)</span>
<span class="va">post_var_tau</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">theta_sim</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="va">ww</span><span class="op">)</span><span class="op">-</span> <span class="va">post_mean_tau</span><span class="op">^</span><span class="fl">2</span>
<span class="va">post_var_tau</span>
<span class="co">#&gt; [1] 24.91431</span></code></pre></div>
<p>Finally, an estimate of the posterior density of each parameter can be obtained by using <em>weighted</em> kernel density estimation:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">theta_sim</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, weights <span class="op">=</span> <span class="va">ww</span>, bw <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Posterior density (mu)"</span>,
  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">theta_sim</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, weights <span class="op">=</span> <span class="va">ww</span>, bw <span class="op">=</span> <span class="fl">7.5</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Posterior density (tau)"</span>,
  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="p6_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Note that the value of the bandwidth used (argument <code>bw</code>) has been set manually so that both curves will match (as the default bandwidth provided a slightly different estimate of the posterior distribution) to enable a fair comparison.</p>
</div>
<div id="metropolis-hastings" class="section level2">
<h2 class="hasAnchor">
<a href="#metropolis-hastings" class="anchor"></a>Metropolis-Hastings</h2>
<p>As above, we have to make inference on two parameters. Hence, the proposal distribution will be a bivariate distribution, i.e., the distribution is defined on vector <span class="math inline">\(\theta = (\mu,\tau)\)</span>.<br>
In fact, we will be sampling <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\tau\)</span> independently from each other, but the two values will be accepted jointly. A new value of <span class="math inline">\(\mu\)</span> will be proposed using a Normal distribution centered at the current value of <span class="math inline">\(\mu\)</span> with precision <span class="math inline">\(10\)</span>, and a new value of <span class="math inline">\(\tau\)</span> will be proposed using a log-Normal distribution with mean the logarithm of the current value and precision <span class="math inline">\(10\)</span>.</p>
<p>All these functions are defined here:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Proposal distribution: sampling</span>
<span class="va">rq</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>  

  <span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="co">#Sample mu</span>
  <span class="va">res</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html">rlnorm</a></span><span class="op">(</span><span class="fl">1</span>, meanlog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, sdlog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="co">#Sample tau</span>

  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">#Proposal distribution: log-density</span>
<span class="va">logdq</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">new.theta</span>, <span class="va">theta</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">new.theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co">#Mu</span>
  <span class="va">res</span> <span class="op">&lt;-</span>  <span class="va">res</span> <span class="op">+</span> 
    <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html">dlnorm</a></span><span class="op">(</span><span class="va">new.theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, meanlog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, sdlog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co">#Tau</span>
<span class="op">}</span>

<span class="co">#Prior distribution</span>
<span class="va">logprior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">0</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">0.001</span><span class="op">)</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co">#Mu</span>
  <span class="va">res</span> <span class="op">&lt;-</span> <span class="va">res</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">dgamma</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">0.01</span>, <span class="fl">0.01</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co">#Tau</span>

  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">#LogLikelihood</span>
<span class="va">loglik</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">theta</span><span class="op">)</span> <span class="op">{</span>
   <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">y</span>, mean <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> 
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Number of iterations</span>
<span class="va">n.iter</span> <span class="op">&lt;-</span> <span class="fl">40500</span>

<span class="co">#Simulations of the parameter</span>
<span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">n.iter</span><span class="op">)</span><span class="op">)</span>

<span class="co">#Initial value</span>
<span class="va">theta</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">1</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">n.iter</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">new.theta</span> <span class="op">&lt;-</span> <span class="fu">rq</span><span class="op">(</span><span class="va">theta</span><span class="op">[[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  
  <span class="co">#Log-Acceptance probability</span>
  <span class="va">logacc.prob</span> <span class="op">&lt;-</span> <span class="fu">loglik</span><span class="op">(</span><span class="va">y</span>, <span class="va">new.theta</span><span class="op">)</span> <span class="op">+</span> <span class="fu">logprior</span><span class="op">(</span><span class="va">new.theta</span><span class="op">)</span> <span class="op">+</span> <span class="fu">logdq</span><span class="op">(</span><span class="va">theta</span><span class="op">[[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">new.theta</span><span class="op">)</span>
  <span class="va">logacc.prob</span> <span class="op">&lt;-</span> <span class="va">logacc.prob</span> <span class="op">-</span> <span class="fu">loglik</span><span class="op">(</span><span class="va">y</span>, <span class="va">theta</span><span class="op">[[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu">logprior</span><span class="op">(</span><span class="va">theta</span><span class="op">[[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> 
    <span class="fu">logdq</span><span class="op">(</span><span class="va">new.theta</span>, <span class="va">theta</span><span class="op">[[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">logacc.prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">logacc.prob</span><span class="op">)</span><span class="co">#0 = log(1)</span>
  
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">logacc.prob</span><span class="op">)</span> <span class="op">{</span>
    <span class="co">#Accept</span>
    <span class="va">theta</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">new.theta</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="co">#Reject</span>
    <span class="va">theta</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>The same burn-in, thinning and summary statistics and plots are computed:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Remove burn-in</span>
<span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span><span class="op">)</span><span class="op">]</span>

<span class="co">#Thinning</span>
<span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">]</span>

<span class="co">#Use matrix format</span>
<span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">theta</span><span class="op">)</span>

<span class="co">#Summary statistics</span>
<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">theta</span>, <span class="fl">2</span>, <span class="va">summary</span><span class="op">)</span>
<span class="co">#&gt;             [,1]      [,2]</span>
<span class="co">#&gt; Min.    1.638520  30.92743</span>
<span class="co">#&gt; 1st Qu. 1.699439  95.00554</span>
<span class="co">#&gt; Median  1.711260 115.63784</span>
<span class="co">#&gt; Mean    1.711036 118.64952</span>
<span class="co">#&gt; 3rd Qu. 1.721982 141.06004</span>
<span class="co">#&gt; Max.    1.777419 238.84464</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="co">#Mean</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"MCMC samples"</span>,
  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Posterior density"</span>,
  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">)</span>
<span class="co">#Precision</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"MCMC samples"</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">tau</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Posterior density"</span>, 
  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">tau</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="p6_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Finally, if you prefer to show the posterior distribution of the variance (instead of that of the precision), then you can simply transform the sampled values of the precision as follows:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sample.var</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">theta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sample.var</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"MCMC samples"</span>, ylab <span class="op">=</span> <span class="st">"variance"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">sample.var</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Posterior density"</span>, xlab <span class="op">=</span> <span class="st">"variance"</span><span class="op">)</span></code></pre></div>
<p><img src="p6_files/figure-html/unnamed-chunk-10-1.png" width="960"></p>
</div>
<div id="exercises" class="section level2">
<h2 class="hasAnchor">
<a href="#exercises" class="anchor"></a>Exercises</h2>
<div id="linear-models" class="section level3">
<h3 class="hasAnchor">
<a href="#linear-models" class="anchor"></a>Linear models</h3>
<p>The previous example can be regarded as a simple linear regression example in which the mean <span class="math inline">\(\mu_i\)</span> (of participant <span class="math inline">\(i\)</span>) is equal to an intercept term <span class="math inline">\(\alpha\)</span>, i.e., <span class="math inline">\(\mu_i = \alpha\)</span>. If a covariate <span class="math inline">\(x_i\)</span> is available, the model could be extended to consider a mean equal to <span class="math inline">\(\mu_i = \alpha + \beta x_i\)</span>.</p>
<p>We can consider the gender of the VIBASS participants as a covariate and add this information to the data set:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span><span class="op">$</span><span class="va">gender</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">15</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">14</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>In the new <code>gender</code> variable, <code>1</code> means that the participant is a woman and <code>0</code> means that the participant is a man. The resulting model is now:</p>
<p><span class="math display">\[
\begin{array}{rcl}
y_i &amp; \sim &amp; N(\mu_i, \tau)\\
\mu_i &amp; = &amp; \alpha + \beta x_i\\
\alpha &amp; \sim &amp; N(0, 0.001)\\
\beta &amp; \sim &amp; N(0, 0.001)\\
\tau &amp; \sim &amp; Ga(0.01, 0.01)
\end{array}
\]</span></p>
<p>Note that that the mean <span class="math inline">\(\mu_i\)</span> is different for different participants as gender is involved, whose value is represented by covariate <span class="math inline">\(x_i\)</span>. Also, the priors of the model parameters have been fully defined (i.e., the distribution parameters are set), but other priors could be used.</p>
<p>In the following exercises you will be using IS and M-H to fit this linear regression model with a single covariate.</p>
</div>
<div id="importance-sampling-1" class="section level3">
<h3 class="hasAnchor">
<a href="#importance-sampling-1" class="anchor"></a>Importance-sampling</h3>
<p>This model can be fitted using IS by sampling values for <span class="math inline">\(\theta =(\alpha, \beta, \tau)\)</span>. Values for these three model parameters can be sampled independently. For <span class="math inline">\(\alpha\)</span> a Normal distribution with mean 1.71 (the average height) and standard deviation <span class="math inline">\(10\)</span> (to have large variability) can be used to sample values, and values of <span class="math inline">\(\beta\)</span> can be sampled from a Normal with zero mean and standard deviation <span class="math inline">\(10\)</span>. Values for <span class="math inline">\(\tau\)</span> can be obtained using a log-Normal with mean <span class="math inline">\(0\)</span> and standard deviation <span class="math inline">\(1.25\)</span>.</p>
<ul>
<li><p>Implement the IS algorithm to fit this model.</p></li>
<li><p>Compute estimates of the posterior mean and variance of the three model parameters.</p></li>
<li><p>Compute the effective sample size for each parameter. What do you observe? Do you think that inference is equally reliable for all three parameters?</p></li>
</ul>
</div>
<div id="metropolis-hastings-1" class="section level3">
<h3 class="hasAnchor">
<a href="#metropolis-hastings-1" class="anchor"></a>Metropolis-Hastings</h3>
<p>Similarly, this model can be fitted using the M-H algorithm. In this case, the proposal distribution needs to provide values of <span class="math inline">\(\theta =(\alpha, \beta, \tau)\)</span>. This can be done independently for each variable as in the example developed above. For each of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>, the proposal distribution can be a Normal distribution with mean the current value and precision 10, while for <span class="math inline">\(\tau\)</span> exactly the same proposal as before can be used.</p>
<ul>
<li><p>Implement the M-H algorithm to fit this model. You can make use of the code above.</p></li>
<li><p>Compute summary statistics of the model parameters and compare them with the ones obtained with IS.</p></li>
</ul>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by VIBASS4, Facundo Muñoz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>

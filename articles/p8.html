<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Practical 8: Optional Extra and Advanced Material â€¢ vibass</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Practical 8: Optional Extra and Advanced Material">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vibass</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/p1.html">Practical 1: Binary data</a>
    </li>
    <li>
      <a href="../articles/p2count.html">Practical 2: Count data</a>
    </li>
    <li>
      <a href="../articles/p2normal.html">Practical 2: Normal data</a>
    </li>
    <li>
      <a href="../articles/p3.html">Practical 3: Bayesian polynomial regression</a>
    </li>
    <li>
      <a href="../articles/p4.html">Practical 4: Simulation-based Bayesian inference</a>
    </li>
    <li>
      <a href="../articles/p5.html">Practical 5: Numerical approaches</a>
    </li>
    <li>
      <a href="../articles/p6.html">Practical 6: Software and GLMs</a>
    </li>
    <li>
      <a href="../articles/p7.html">Practical 7: Bayesian Hierarchical Modelling</a>
    </li>
    <li>
      <a href="../articles/p8.html">Practical 8: Optional Extra and Advanced Material</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/VABAR/vibass/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Practical 8: Optional Extra and Advanced
Material</h1>
                        <h4 data-toc-skip class="author">VIBASS</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/VABAR/vibass/blob/main/vignettes/p8.Rmd" class="external-link"><code>vignettes/p8.Rmd</code></a></small>
      <div class="hidden name"><code>p8.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This practical is entirely optional, and presents additional and
advanced material you may wish to try out if you have completed all the
work in the first seven practicals, and have no further questions for
us.</p>
<p>We start with an example where we implement specific R code for
running the linear regression example of Practical 5; then we repeat the
examples of Practicals 6 and 7 but using <code>INLA</code> rather than
<code>BayesX</code>. Note we did not include <code>INLA</code> examples
in the main material as we did not want to have too many different
packages included, which would detract from the most important part -
learning about Bayesian Statistics!</p>
</div>
<div class="section level2">
<h2 id="example-simple-linear-regression">Example: Simple Linear Regression<a class="anchor" aria-label="anchor" href="#example-simple-linear-regression"></a>
</h2>
<p>We will illustrate the use of Gibbs Sampling on a simple linear
regression model. Recall that we saw yesterday that we can obtain an
analytical solution for a Bayesian linear regression, but that more
complex models require a simulation approach; in Practical 5, we used
the package <code>MCMCpack</code> to fit the model using Gibbs
Sampling.</p>
<p>The approach we take here for Gibbs Sampling on a simple linear
regression model is very easily generalised to more complex models, the
key is that whatever your model looks like, you update one parameter at
a time, using the conditional distribution of that parameter given the
current values of all the other parameters.</p>
<p>The simple linear regression model we will analyse here is a reduced
version of the general linear regression model we saw yesterday, and the
same one as in Practical 5:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>i</mi></msub><mo>=</mo><msub><mi>Î²</mi><mn>0</mn></msub><mo>+</mo><msub><mi>Î²</mi><mn>1</mn></msub><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><msub><mi>Ïµ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">
Y_i = \beta_0+\beta_1x_i+\epsilon_i
</annotation></semantics></math> for response variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ˜</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mn>1</mn></msub><mo>,</mo><msub><mi>Y</mi><mn>2</mn></msub><mo>,</mo><mi>â€¦</mi><mo>,</mo><msub><mi>Y</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{Y}=\left(Y_1,Y_2,\ldots,Y_n\right)</annotation></semantics></math>,
explanatory variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ±</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mi>â€¦</mi><mo>,</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{x}=\left(x_1,x_2,\ldots,x_n\right)</annotation></semantics></math>
and residual vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ›œ</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ïµ</mi><mn>1</mn></msub><mo>,</mo><msub><mi>Ïµ</mi><mn>2</mn></msub><mo>,</mo><mi>â€¦</mi><mo>,</mo><msub><mi>Ïµ</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{\epsilon}=
\left(\epsilon_1,\epsilon_2,\ldots,\epsilon_n\right)</annotation></semantics></math>
for a sample of size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î²</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\beta_0</annotation></semantics></math>
is the regression intercept,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î²</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\beta_1</annotation></semantics></math>
is the regression slope, and where the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ïµ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\epsilon_i</annotation></semantics></math>
are independent with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Ïµ</mi><mi>i</mi></msub><mo>âˆ¼</mo><mtext mathvariant="normal">N</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msup><mi>Ïƒ</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\epsilon_i\sim \textrm{N}\left(0,\sigma^2\right)</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>âˆ€</mo><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mi>â€¦</mi><mo>,</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">\forall i=1,2,\ldots,n</annotation></semantics></math>.
For convenience, we refer to the combined set of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ˜</mi><annotation encoding="application/x-tex">\mathbf{Y}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ±</mi><annotation encoding="application/x-tex">\mathbf{x}</annotation></semantics></math>
data as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ’Ÿ</mi><annotation encoding="application/x-tex">\mathcal{D}</annotation></semantics></math>.
We also define
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>ğ²</mi><mo accent="true">Ì‚</mo></mover><annotation encoding="application/x-tex">\hat{\mathbf{y}}</annotation></semantics></math>
to be the fitted response vector (i.e.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>y</mi><mo accent="true">Ì‚</mo></mover><mi>i</mi></msub><mo>=</mo><msub><mi>Î²</mi><mn>0</mn></msub><mo>+</mo><msub><mi>Î²</mi><mn>1</mn></msub><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\hat{y}_i = \beta_0 + \beta_1 x_i</annotation></semantics></math>
from the regression equation) using the current values of the parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î²</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\beta_0</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î²</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\beta_1</annotation></semantics></math>
and precision
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï„</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\tau = 1</annotation></semantics></math>
(remember that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï„</mi><mo>=</mo><mfrac><mn>1</mn><msup><mi>Ïƒ</mi><mn>2</mn></msup></mfrac></mrow><annotation encoding="application/x-tex">\tau=\frac{1}{\sigma^2}</annotation></semantics></math>)
from the Gibbs Sampling simulations.</p>
<p>For Bayesian inference, it is simpler to work with precisions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï„</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
rather than with variances
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Ïƒ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\sigma^2</annotation></semantics></math>.
Given priors
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Ï„</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mtext mathvariant="normal">Ga</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î±</mi><mo>,</mo><mi>Î²</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î²</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mtext mathvariant="normal">N</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¼</mi><msub><mi>Î²</mi><mn>0</mn></msub></msub><mo>,</mo><msub><mi>Ï„</mi><msub><mi>Î²</mi><mn>0</mn></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mtext mathvariant="normal">and</mtext></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î²</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mtext mathvariant="normal">N</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¼</mi><msub><mi>Î²</mi><mn>1</mn></msub></msub><mo>,</mo><msub><mi>Ï„</mi><msub><mi>Î²</mi><mn>1</mn></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{align*}
\pi(\tau) &amp;= \textrm{Ga}\left(\alpha, \beta\right), \\
\pi(\beta_0) &amp;= \textrm{N}\left(\mu_{\beta_0}, \tau_{\beta_0}\right), \quad\textrm{and} \\
\pi(\beta_1) &amp;= \textrm{N}\left(\mu_{\beta_1}, \tau_{\beta_1}\right)
\end{align*}
</annotation></semantics></math> then by combining with the likelihood
we can derive the full conditional distributions for each parameter. For
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï„</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>,
we have
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Ï„</mi><mo stretchy="false" form="prefix">|</mo><mi>ğ’Ÿ</mi><mo>,</mo><msub><mi>Î²</mi><mn>0</mn></msub><mo>,</mo><msub><mi>Î²</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ</mo><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Ï„</mi><mo stretchy="true" form="postfix">)</mo></mrow><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>L</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mover><msub><mi>y</mi><mi>i</mi></msub><mo accent="true">Ì‚</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msup><mi>Ï„</mi><mrow><mi>Î±</mi><mo>âˆ’</mo><mn>1</mn></mrow></msup><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>Î²</mi><mi>Ï„</mi></mrow></msup><msup><mi>Ï„</mi><mfrac><mi>n</mi><mn>2</mn></mfrac></msup><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mo>âˆ’</mo><mfrac><mi>Ï„</mi><mn>2</mn></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ’</mo><mover><msub><mi>y</mi><mi>i</mi></msub><mo accent="true">Ì‚</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">}</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msup><mi>Ï„</mi><mrow><mi>Î±</mi><mo>âˆ’</mo><mn>1</mn><mo>+</mo><mfrac><mi>n</mi><mn>2</mn></mfrac></mrow></msup><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mo>âˆ’</mo><mi>Î²</mi><mi>Ï„</mi><mo>âˆ’</mo><mfrac><mi>Ï„</mi><mn>2</mn></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ’</mo><mover><msub><mi>y</mi><mi>i</mi></msub><mo accent="true">Ì‚</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">}</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mtext mathvariant="normal">so</mtext><mspace width="1.0em"></mspace><mi>Ï„</mi><mo stretchy="false" form="prefix">|</mo><mi>ğ’Ÿ</mi><mo>,</mo><msub><mi>Î²</mi><mn>0</mn></msub><mo>,</mo><msub><mi>Î²</mi><mn>1</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mtext mathvariant="normal">Ga</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î±</mi><mo>+</mo><mfrac><mi>n</mi><mn>2</mn></mfrac><mo>,</mo><mi>Î²</mi><mo>+</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ’</mo><mover><msub><mi>y</mi><mi>i</mi></msub><mo accent="true">Ì‚</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{align*}
\pi\left(\tau|\mathcal{D}, \beta_0, \beta_1\right) &amp;\propto
\pi(\tau)\prod_{i=1}^nL\left(y_i|\hat{y_i}\right), \\
&amp;= \tau^{\alpha-1}e^{-\beta\tau}
\tau^{\frac{n}{2}}\exp\left\{-
\frac{\tau}{2}\sum_{i=1}^n(y_i-\hat{y_i})^2\right\}, \\
&amp;= \tau^{\alpha-1 + \frac{n}{2}}\exp\left\{-\beta\tau-
\frac{\tau}{2}\sum_{i=1}^n(y_i-\hat{y_i})^2\right\},\\
\textrm{so} \quad \tau|\mathcal{D}, \beta_0, \beta_1 &amp;\sim
\textrm{Ga}\left(\alpha+\frac{n}{2},
\beta +\frac{1}{2}\sum_{i=1}^n(y_i-\hat{y_i})^2\right).
\end{align*}
</annotation></semantics></math> For
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î²</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\beta_0</annotation></semantics></math>
we will need to expand
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>y</mi><mo accent="true">Ì‚</mo></mover><mi>i</mi></msub><mo>=</mo><msub><mi>Î²</mi><mn>0</mn></msub><mo>+</mo><msub><mi>Î²</mi><mn>1</mn></msub><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\hat{y}_i=\beta_0+\beta_1x_i</annotation></semantics></math>,
and then we have
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î²</mi><mn>0</mn></msub><mo stretchy="false" form="prefix">|</mo><mi>ğ’Ÿ</mi><mo>,</mo><msub><mi>Î²</mi><mn>1</mn></msub><mo>,</mo><mi>Ï„</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ</mo><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î²</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>L</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mover><msub><mi>y</mi><mi>i</mi></msub><mo accent="true">Ì‚</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msubsup><mi>Ï„</mi><msub><mi>Î²</mi><mn>0</mn></msub><mfrac><mn>1</mn><mn>2</mn></mfrac></msubsup><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mo>âˆ’</mo><mfrac><msub><mi>Ï„</mi><msub><mi>Î²</mi><mn>0</mn></msub></msub><mn>2</mn></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î²</mi><mn>0</mn></msub><mo>âˆ’</mo><msub><mi>Î¼</mi><msub><mi>Î²</mi><mn>0</mn></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">}</mo></mrow><msup><mi>Ï„</mi><mfrac><mi>n</mi><mn>2</mn></mfrac></msup><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mo>âˆ’</mo><mfrac><mi>Ï„</mi><mn>2</mn></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ’</mo><mover><msub><mi>y</mi><mi>i</mi></msub><mo accent="true">Ì‚</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">}</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mo>âˆ’</mo><mfrac><msub><mi>Ï„</mi><msub><mi>Î²</mi><mn>0</mn></msub></msub><mn>2</mn></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î²</mi><mn>0</mn></msub><mo>âˆ’</mo><msub><mi>Î¼</mi><msub><mi>Î²</mi><mn>0</mn></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>âˆ’</mo><mfrac><mi>Ï„</mi><mn>2</mn></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>Î²</mi><mn>0</mn></msub><mo>âˆ’</mo><msub><mi>x</mi><mi>i</mi></msub><msub><mi>Î²</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">}</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mo>âˆ’</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>Î²</mi><mn>0</mn><mn>2</mn></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ï„</mi><msub><mi>Î²</mi><mn>0</mn></msub></msub><mo>+</mo><mi>n</mi><mi>Ï„</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>Î²</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mo>âˆ’</mo><mn>2</mn><msub><mi>Ï„</mi><msub><mi>Î²</mi><mn>0</mn></msub></msub><msub><mi>Î¼</mi><msub><mi>Î²</mi><mn>0</mn></msub></msub><mo>âˆ’</mo><mn>2</mn><mi>Ï„</mi><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>x</mi><mi>i</mi></msub><msub><mi>Î²</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>C</mi><mo stretchy="true" form="postfix">}</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mtext mathvariant="normal">so</mtext><mspace width="1.0em"></mspace><msub><mi>Î²</mi><mn>0</mn></msub><mo stretchy="false" form="prefix">|</mo><mi>ğ’Ÿ</mi><mo>,</mo><msub><mi>Î²</mi><mn>1</mn></msub><mo>,</mo><mi>Ï„</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mi>ğ’©</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ï„</mi><msub><mi>Î²</mi><mn>0</mn></msub></msub><mo>+</mo><mi>n</mi><mi>Ï„</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ï„</mi><msub><mi>Î²</mi><mn>0</mn></msub></msub><msub><mi>Î¼</mi><msub><mi>Î²</mi><mn>0</mn></msub></msub><mo>+</mo><mi>Ï„</mi><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>x</mi><mi>i</mi></msub><msub><mi>Î²</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><msub><mi>Ï„</mi><msub><mi>Î²</mi><mn>0</mn></msub></msub><mo>+</mo><mi>n</mi><mi>Ï„</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{align*}
p(\beta_0|\mathcal{D}, \beta_1, \tau) &amp;\propto
\pi(\beta_0)\prod_{i=1}^nL\left(y_i|\hat{y_i}\right), \\
&amp;= \tau_{\beta_0}^{\frac{1}{2}}\exp\left\{-
\frac{\tau_{\beta_0}}{2}(\beta_0-\mu_{\beta_0})^2\right\}\tau^\frac{n}{2}
\exp\left\{-\frac{\tau}{2}\sum_{i=1}^n(y_i-\hat{y_i})^2\right\}, \\
&amp;\propto \exp\left\{-\frac{\tau_{\beta_0}}{2}(\beta_0-\mu_{\beta_0})^2-
\frac{\tau}{2}\sum_{i=1}^n(y_i-\beta_0-x_i \beta_1)^2\right\}, \\
&amp;= \exp \left\{ -\frac{1}{2}\left(\beta_0^2(\tau_{\beta_0} + n\tau) +
\beta_0\left(-2\tau_{\beta_0}\mu_{\beta_0} - 2\tau\sum_{i=1}^n 
(y_i - x_i\beta_1)\right) \right) + C \right\}, \\
\textrm{so} \quad \beta_0|\mathcal{D}, \beta_1, \tau &amp;\sim
\mathcal{N}\left((\tau_{\beta_0} + n\tau)^{-1}
\left(\tau_{\beta_0}\mu_{\beta_0} + \tau\sum_{i=1}^n (y_i - x_i\beta_1)\right),
\tau_{\beta_0} + n\tau\right).
\end{align*}
</annotation></semantics></math></p>
<p>In the above,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>C</mi><annotation encoding="application/x-tex">C</annotation></semantics></math>
represents a quantity that is constant with respect to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î²</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\beta_0</annotation></semantics></math>
and hence can be ignored. Finally, for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î²</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\beta_1</annotation></semantics></math>
we have
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î²</mi><mn>1</mn></msub><mo stretchy="false" form="prefix">|</mo><mi>ğ’Ÿ</mi><mo>,</mo><msub><mi>Î²</mi><mn>0</mn></msub><mo>,</mo><mi>Ï„</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ</mo><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î²</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>L</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mover><msub><mi>y</mi><mi>i</mi></msub><mo accent="true">Ì‚</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msubsup><mi>Ï„</mi><msub><mi>Î²</mi><mn>1</mn></msub><mfrac><mn>1</mn><mn>2</mn></mfrac></msubsup><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mo>âˆ’</mo><mfrac><msub><mi>Ï„</mi><msub><mi>Î²</mi><mn>1</mn></msub></msub><mn>2</mn></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î²</mi><mn>1</mn></msub><mo>âˆ’</mo><msub><mi>Î¼</mi><msub><mi>Î²</mi><mn>1</mn></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">}</mo></mrow><msup><mi>Ï„</mi><mfrac><mi>n</mi><mn>2</mn></mfrac></msup><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mo>âˆ’</mo><mfrac><mi>Ï„</mi><mn>2</mn></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ’</mo><mover><msub><mi>y</mi><mi>i</mi></msub><mo accent="true">Ì‚</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">}</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mo>âˆ’</mo><mfrac><msub><mi>Ï„</mi><msub><mi>Î²</mi><mn>1</mn></msub></msub><mn>2</mn></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î²</mi><mn>1</mn></msub><mo>âˆ’</mo><msub><mi>Î¼</mi><msub><mi>Î²</mi><mn>1</mn></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>âˆ’</mo><mfrac><mi>Ï„</mi><mn>2</mn></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>Î²</mi><mn>0</mn></msub><mo>âˆ’</mo><msub><mi>x</mi><mi>i</mi></msub><msub><mi>Î²</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">}</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mo>âˆ’</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>Î²</mi><mn>1</mn><mn>2</mn></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ï„</mi><msub><mi>Î²</mi><mn>1</mn></msub></msub><mo>+</mo><mi>Ï„</mi><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msubsup><mi>x</mi><mi>i</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>Î²</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mo>âˆ’</mo><mn>2</mn><msub><mi>Ï„</mi><msub><mi>Î²</mi><mn>1</mn></msub></msub><msub><mi>Î¼</mi><msub><mi>Î²</mi><mn>1</mn></msub></msub><mo>âˆ’</mo><mn>2</mn><mi>Ï„</mi><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>Î²</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>C</mi><mo stretchy="true" form="postfix">}</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mtext mathvariant="normal">so</mtext><mspace width="1.0em"></mspace><msub><mi>Î²</mi><mn>1</mn></msub><mo stretchy="false" form="prefix">|</mo><mi>ğ’Ÿ</mi><mo>,</mo><msub><mi>Î²</mi><mn>0</mn></msub><mo>,</mo><mi>Ï„</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mtext mathvariant="normal">N</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ï„</mi><msub><mi>Î²</mi><mn>1</mn></msub></msub><mo>+</mo><mi>Ï„</mi><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msubsup><mi>x</mi><mi>i</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ï„</mi><msub><mi>Î²</mi><mn>1</mn></msub></msub><msub><mi>Î¼</mi><msub><mi>Î²</mi><mn>1</mn></msub></msub><mo>+</mo><mi>Ï„</mi><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>Î²</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><msub><mi>Ï„</mi><msub><mi>Î²</mi><mn>1</mn></msub></msub><mo>+</mo><mi>Ï„</mi><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msubsup><mi>x</mi><mi>i</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{align*}
p(\beta_1|\mathcal{D}, \beta_0, \tau) &amp;\propto
\pi(\beta_1)\prod_{i=1}^nL\left(y_i|\hat{y_i}\right), \\
&amp;= \tau_{\beta_1}^{\frac{1}{2}}\exp\left\{-
\frac{\tau_{\beta_1}}{2}(\beta_1-\mu_{\beta_1})^2\right\}\tau^\frac{n}{2}
\exp\left\{-\frac{\tau}{2}\sum_{i=1}^n(y_i-\hat{y_i})^2\right\}, \\
&amp;\propto \exp\left\{-\frac{\tau_{\beta_1}}{2}(\beta_1-\mu_{\beta_1})^2-
\frac{\tau}{2}\sum_{i=1}^n(y_i-\beta_0-x_i \beta_1)^2\right\}, \\
&amp;= \exp \left\{ -\frac{1}{2}\left(\beta_1^2\left(\tau_{\beta_1} + 
\tau\sum_{i=1}^n x_i^2\right) +
\beta_1\left(-2\tau_{\beta_1}\mu_{\beta_1} - 2\tau\sum_{i=1}^n 
(y_i - \beta_0)x_i\right) \right) + C \right\}, \\
\textrm{so} \quad \beta_1|\mathcal{D}, \beta_0, \tau
&amp;\sim \textrm{N}\left((\tau_{\beta_1} + \tau\sum_{i=1}^n x_i^2)^{-1}
\left(\tau_{\beta_1}\mu_{\beta_1} + \tau\sum_{i=1}^n (y_i - \beta_0)x_i\right),
\tau_{\beta_1} + \tau\sum_{i=1}^n x_i^2\right).
\end{align*}
</annotation></semantics></math> This gives us an easy way to run Gibbs
Sampling for linear regression; we have standard distributions as full
conditionals and there are standard functions in R to obtain the
simulations.</p>
<p>We shall do this now for an example in ecology, looking at the
relationship between water pollution and mayfly size - the data come
from the book <em>Statistics for Ecologists Using R and Excel 2nd
edition</em> by Mark Gardener (ISBN 9781784271398), see <a href="https://pelagicpublishing.com/products/statistics-for-ecologists-using-r-and-excel-gardener-2nd-edition" class="external-link">the
publisherâ€™s webpage</a>.</p>
<p>The data are as follows:</p>
<ul>
<li><p><code>length</code> - the length of a mayfly in mm;</p></li>
<li><p><code>BOD</code> - biological oxygen demand in mg of oxygen per
litre, effectively a measure of organic pollution (since more organic
pollution requires more oxygen to break it down).</p></li>
</ul>
<p>The data can be read into R:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read in data</span></span>
<span><span class="va">BOD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>,<span class="fl">180</span>,<span class="fl">135</span>,<span class="fl">120</span>,<span class="fl">110</span>,<span class="fl">120</span>,<span class="fl">95</span>,<span class="fl">168</span>,<span class="fl">180</span>,<span class="fl">195</span>,<span class="fl">158</span>,<span class="fl">145</span>,<span class="fl">140</span>,<span class="fl">145</span>,<span class="fl">165</span>,<span class="fl">187</span>,</span>
<span>         <span class="fl">190</span>,<span class="fl">157</span>,<span class="fl">90</span>,<span class="fl">235</span>,<span class="fl">200</span>,<span class="fl">55</span>,<span class="fl">87</span>,<span class="fl">97</span>,<span class="fl">95</span><span class="op">)</span></span>
<span><span class="va">mayfly.length</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">21</span>,<span class="fl">22</span>,<span class="fl">23</span>,<span class="fl">21</span>,<span class="fl">20</span>,<span class="fl">19</span>,<span class="fl">16</span>,<span class="fl">15</span>,<span class="fl">14</span>,<span class="fl">21</span>,<span class="fl">21</span>,<span class="fl">21</span>,<span class="fl">20</span>,<span class="fl">19</span>,<span class="fl">18</span>,<span class="fl">17</span>,<span class="fl">19</span>,<span class="fl">21</span>,<span class="fl">13</span>,</span>
<span>            <span class="fl">16</span>,<span class="fl">25</span>,<span class="fl">24</span>,<span class="fl">23</span>,<span class="fl">22</span><span class="op">)</span></span>
<span><span class="co"># Create data frame for the Gibbs Sampling, needs x and y</span></span>
<span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">BOD</span>,y<span class="op">=</span><span class="va">mayfly.length</span><span class="op">)</span></span></code></pre></div>
<p>We provide here some simple functions for running the analysis by
Gibbs Sampling, using the full conditionals derived above. The functions
assume you have a data frame with two columns, the response
<code>y</code> and the covariate <code>x</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Function to update tau, the precision</span></span>
<span><span class="va">sample_tau</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">beta0</span>, <span class="va">beta1</span>, <span class="va">alphatau</span>, <span class="va">betatau</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fl">1</span>,</span>
<span>    shape <span class="op">=</span> <span class="va">alphatau</span><span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>    rate <span class="op">=</span> <span class="va">betatau</span><span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="op">(</span><span class="va">beta0</span> <span class="op">+</span> <span class="va">data</span><span class="op">$</span><span class="va">x</span><span class="op">*</span><span class="va">beta1</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Function to update beta0, the regression intercept</span></span>
<span><span class="va">sample_beta0</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">beta1</span>, <span class="va">tau</span>, <span class="va">mu0</span>, <span class="va">tau0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">prec</span> <span class="op">&lt;-</span> <span class="va">tau0</span> <span class="op">+</span> <span class="va">tau</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span>  <span class="va">mean</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">tau0</span><span class="op">*</span><span class="va">mu0</span> <span class="op">+</span> <span class="va">tau</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="va">data</span><span class="op">$</span><span class="va">x</span><span class="op">*</span><span class="va">beta1</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">prec</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="va">mean</span>, sd <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">prec</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Function to update beta1, the regression slope</span></span>
<span><span class="va">sample_beta1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">beta0</span>, <span class="va">tau</span>, <span class="va">mu1</span>, <span class="va">tau1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">prec</span> <span class="op">&lt;-</span> <span class="va">tau1</span> <span class="op">+</span> <span class="va">tau</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">x</span> <span class="op">*</span> <span class="va">data</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">mean</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">tau1</span><span class="op">*</span><span class="va">mu1</span> <span class="op">+</span> <span class="va">tau</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="va">beta0</span><span class="op">)</span> <span class="op">*</span> <span class="va">data</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">prec</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="va">mean</span>, sd <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">prec</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Function to run the Gibbs Sampling, where you specify the number of</span></span>
<span><span class="co"># simulations `m`, the starting values for each of the three regression</span></span>
<span><span class="co"># parameters (`tau_start` etc), and the parameters for the prior</span></span>
<span><span class="co"># distributions of tau, beta0 and beta1</span></span>
<span><span class="va">gibbs_sample</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>,</span>
<span>                         <span class="va">tau_start</span>,</span>
<span>                         <span class="va">beta0_start</span>,</span>
<span>                         <span class="va">beta1_start</span>,</span>
<span>                         <span class="va">m</span>,</span>
<span>                         <span class="va">alpha_tau</span>,</span>
<span>                         <span class="va">beta_tau</span>,</span>
<span>                         <span class="va">mu_beta0</span>,</span>
<span>                         <span class="va">tau_beta0</span>,</span>
<span>                         <span class="va">mu_beta1</span>,</span>
<span>                         <span class="va">tau_beta1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tau</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">beta0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">beta1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">tau</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">tau_start</span></span>
<span>  <span class="va">beta0</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">beta0_start</span></span>
<span>  <span class="va">beta1</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">beta1_start</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">m</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tau</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>      <span class="fu">sample_tau</span><span class="op">(</span><span class="va">data</span>, <span class="va">beta0</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="va">beta1</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="va">alpha_tau</span>, <span class="va">beta_tau</span><span class="op">)</span></span>
<span>    <span class="va">beta0</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>      <span class="fu">sample_beta0</span><span class="op">(</span><span class="va">data</span>, <span class="va">beta1</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="va">tau</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">mu_beta0</span>, <span class="va">tau_beta0</span><span class="op">)</span></span>
<span>    <span class="va">beta1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">sample_beta1</span><span class="op">(</span><span class="va">data</span>, <span class="va">beta0</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">tau</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">mu_beta1</span>, <span class="va">tau_beta1</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">Iteration</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">m</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">Iteration</span>,<span class="va">beta0</span>,<span class="va">beta1</span>,<span class="va">tau</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level3">
<h3 id="exercises">Exercises<a class="anchor" aria-label="anchor" href="#exercises"></a>
</h3>
<p>We will use Gibbs Sampling to fit a Bayesian Linear Regression model
to the mayfly data, with the above code. We will use the following prior
distributions for the regression parameters:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Ï„</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mtext mathvariant="normal">Ga</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î²</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mtext mathvariant="normal">N</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>0.0001</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mtext mathvariant="normal">and</mtext></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î²</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mtext mathvariant="normal">N</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>0.0001</mn><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{align*}
\pi(\tau) &amp;= \textrm{Ga}\left(1, 1\right), \\
\pi(\beta_0) &amp;= \textrm{N}\left(0, 0.0001\right), \quad\textrm{and} \\
\pi(\beta_1) &amp;= \textrm{N}\left(0, 0.0001\right).
\end{align*}
</annotation></semantics></math> We will set the initial values of all
parameters to 1,
i.e.Â <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>Î²</mi><mn>0</mn><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>=</mo><msubsup><mi>Î²</mi><mn>1</mn><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>=</mo><msup><mi>Ï„</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\beta_0^{(0)}=\beta_1^{(0)}=\tau^{(0)}=1</annotation></semantics></math>.</p>
<div class="section level4">
<h4 id="data-exploration">Data exploration<a class="anchor" aria-label="anchor" href="#data-exploration"></a>
</h4>
<ul>
<li>
<p>Investigate the data to see whether a linear regression model
would be sensible. [You may not need to do this step if you recall the
outputs from Practical 5.]</p>
<details><summary><p>Solution</p>
</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Scatterplot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">BOD</span>,<span class="va">mayfly.length</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"><div class="figcaption">plot of chunk unnamed-chunk-3</div>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Correlation with hypothesis test</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">cor.test</a></span><span class="op">(</span><span class="va">BOD</span>,<span class="va">mayfly.length</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Pearson's product-moment correlation</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  BOD and mayfly.length</span></span>
<span><span class="co">## t = -6.52, df = 23, p-value = 1.185e-06</span></span>
<span><span class="co">## alternative hypothesis: true correlation is not equal to 0</span></span>
<span><span class="co">## 95 percent confidence interval:</span></span>
<span><span class="co">##  -0.9107816 -0.6020516</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">##        cor </span></span>
<span><span class="co">## -0.8055507</span></span></code></pre>
</details>
</li>
<li>
<p>Run a frequentist simple linear regression using the
<code>lm</code> function in R; this will be useful for comparison with
our Bayesian analysis.</p>
<details><summary><p>Solution</p>
</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Linear Regression using lm()</span></span>
<span><span class="va">linreg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mayfly.length</span> <span class="op">~</span> <span class="va">BOD</span>, data <span class="op">=</span> <span class="va">Data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">linreg</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = mayfly.length ~ BOD, data = Data)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">## -3.453 -1.073  0.307  1.105  3.343 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept) 27.697314   1.290822   21.46  &lt; 2e-16 ***</span></span>
<span><span class="co">## BOD         -0.055202   0.008467   -6.52 1.18e-06 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 1.865 on 23 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.6489, Adjusted R-squared:  0.6336 </span></span>
<span><span class="co">## F-statistic: 42.51 on 1 and 23 DF,  p-value: 1.185e-06</span></span></code></pre>
</details>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="running-the-gibbs-sampler">Running the Gibbs Sampler<a class="anchor" aria-label="anchor" href="#running-the-gibbs-sampler"></a>
</h4>
<ul>
<li>
<p>Use the code above to fit a Bayesian simple linear regression
using <code>length</code> as the response variable. Ensure you have a
burn-in period so that the initial simulations are discarded. Use the
output from <code>gibbs_sample</code> to estimate the regression
parameters (with uncertainty measures). Also plot the estimates of the
posterior distributions.</p>
<details><summary><p>Solution</p>
</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bayesian Linear Regression using a Gibbs Sampler</span></span>
<span></span>
<span><span class="co"># Set the number of iterations of the Gibbs Sampler - including how many to</span></span>
<span><span class="co"># discard as the burn-in</span></span>
<span><span class="va">m.burnin</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">m.keep</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m.burnin</span> <span class="op">+</span> <span class="va">m.keep</span></span>
<span></span>
<span><span class="co"># Obtain the samples</span></span>
<span><span class="va">results1</span> <span class="op">&lt;-</span> <span class="fu">gibbs_sample</span><span class="op">(</span><span class="va">Data</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="va">m</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0.0001</span>,<span class="fl">0</span>,<span class="fl">0.0001</span><span class="op">)</span></span>
<span><span class="co"># Remove the burn-in</span></span>
<span><span class="va">results1</span> <span class="op">&lt;-</span> <span class="va">results1</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">m.burnin</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="co"># Add variance and standard deviation columns</span></span>
<span><span class="va">results1</span><span class="op">$</span><span class="va">Variance</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">results1</span><span class="op">$</span><span class="va">tau</span></span>
<span><span class="va">results1</span><span class="op">$</span><span class="va">StdDev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">results1</span><span class="op">$</span><span class="va">Variance</span><span class="op">)</span></span>
<span><span class="co"># Estimates are the column means</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">results1</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       beta0       beta1         tau    Variance      StdDev </span></span>
<span><span class="co">## 27.65318069 -0.05486106  0.30030561  3.64651228  1.88708959</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Also look at uncertainty</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">results1</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">2</span>,<span class="va">sd</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       beta0       beta1         tau    Variance      StdDev </span></span>
<span><span class="co">## 1.333977050 0.008754095 0.088994547 1.180979250 0.292387827</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">results1</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">2</span>,<span class="va">quantile</span>,probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>,<span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          beta0       beta1       tau Variance   StdDev</span></span>
<span><span class="co">## 2.5%  24.94863 -0.07188798 0.1532262 1.997486 1.413324</span></span>
<span><span class="co">## 97.5% 30.31030 -0.03701739 0.5006294 6.526298 2.554662</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Kernel density plots for beta0, beta1 and the residual stanard deviation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">results1</span><span class="op">$</span><span class="va">beta0</span>, bw <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Posterior density for beta0"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5"><div class="figcaption">plot of chunk unnamed-chunk-5</div>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">results1</span><span class="op">$</span><span class="va">beta1</span>, bw <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Posterior density for beta1"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-5-2.png" alt="plot of chunk unnamed-chunk-5"><div class="figcaption">plot of chunk unnamed-chunk-5</div>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">results1</span><span class="op">$</span><span class="va">StdDev</span>, bw <span class="op">=</span> <span class="fl">0.075</span><span class="op">)</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Posterior density for StdDev"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-5-3.png" alt="plot of chunk unnamed-chunk-5"><div class="figcaption">plot of chunk unnamed-chunk-5</div>
</div>
</details>
</li>
<li>
<p>Use the function <code><a href="https://rdrr.io/r/stats/ts.plot.html" class="external-link">ts.plot()</a></code> to view the
autocorrelation in the Gibbs sampling simulation chain. Is there any
visual evidence of autocorrelation, or do the samples look
independent?</p>
<details><summary><p>Solution</p>
</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot sampled series</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/ts.plot.html" class="external-link">ts.plot</a></span><span class="op">(</span><span class="va">results1</span><span class="op">$</span><span class="va">beta0</span>,ylab<span class="op">=</span><span class="st">"beta0"</span>,xlab<span class="op">=</span><span class="st">"Iteration"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6"><div class="figcaption">plot of chunk unnamed-chunk-6</div>
</div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/ts.plot.html" class="external-link">ts.plot</a></span><span class="op">(</span><span class="va">results1</span><span class="op">$</span><span class="va">beta1</span>,ylab<span class="op">=</span><span class="st">"beta1"</span>,xlab<span class="op">=</span><span class="st">"Iteration"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-6-2.png" alt="plot of chunk unnamed-chunk-6"><div class="figcaption">plot of chunk unnamed-chunk-6</div>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/ts.plot.html" class="external-link">ts.plot</a></span><span class="op">(</span><span class="va">results1</span><span class="op">$</span><span class="va">StdDev</span>,ylab<span class="op">=</span><span class="st">"sigma"</span>,xlab<span class="op">=</span><span class="st">"Iteration"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-6-3.png" alt="plot of chunk unnamed-chunk-6"><div class="figcaption">plot of chunk unnamed-chunk-6</div>
</div>
</details>
</li>
<li><p>How do the results compare with the frequentist output?</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="reducing-the-autocorrelation-by-mean-centering-the-covariate">Reducing the autocorrelation by mean-centering the covariate<a class="anchor" aria-label="anchor" href="#reducing-the-autocorrelation-by-mean-centering-the-covariate"></a>
</h4>
<ul>
<li>
<p>One method for reducing the autocorrelation in the sampling
chains for regression parameters is to mean centre the covariate(s);
this works because it reduces any dependence between the regression
intercept and slope(s). Do this for the current example, noting that you
will need to make a correction on the estimate of the regression
intercept afterwards.</p>
<details><summary><p>Solution</p>
</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Mean-centre the x covariate</span></span>
<span><span class="va">DataC</span> <span class="op">&lt;-</span> <span class="va">Data</span></span>
<span><span class="va">meanx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">DataC</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">DataC</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">DataC</span><span class="op">$</span><span class="va">x</span> <span class="op">-</span> <span class="va">meanx</span></span>
<span></span>
<span><span class="co"># Bayesian Linear Regression using a Gibbs Sampler</span></span>
<span></span>
<span><span class="co"># Set the number of iterations of the Gibbs Sampler - including how many to</span></span>
<span><span class="co"># discard as the burn-in</span></span>
<span><span class="va">m.burnin</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">m.keep</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m.burnin</span> <span class="op">+</span> <span class="va">m.keep</span></span>
<span></span>
<span><span class="co"># Obtain the samples</span></span>
<span><span class="va">results2</span> <span class="op">&lt;-</span> <span class="fu">gibbs_sample</span><span class="op">(</span><span class="va">DataC</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="va">m</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0.0001</span>, <span class="fl">0</span>, <span class="fl">0.0001</span><span class="op">)</span></span>
<span><span class="co"># Remove the burn-in</span></span>
<span><span class="va">results2</span> <span class="op">&lt;-</span> <span class="va">results2</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">m.burnin</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Correct the effect of the mean-centering on the intercept</span></span>
<span><span class="va">results2</span><span class="op">$</span><span class="va">beta0</span> <span class="op">&lt;-</span> <span class="va">results2</span><span class="op">$</span><span class="va">beta0</span> <span class="op">-</span> <span class="va">meanx</span> <span class="op">*</span> <span class="va">results2</span><span class="op">$</span><span class="va">beta1</span></span>
<span></span>
<span><span class="co"># Add variance and standard deviation columns</span></span>
<span><span class="va">results2</span><span class="op">$</span><span class="va">Variance</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">results2</span><span class="op">$</span><span class="va">tau</span></span>
<span><span class="va">results2</span><span class="op">$</span><span class="va">StdDev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">results2</span><span class="op">$</span><span class="va">Variance</span><span class="op">)</span></span>
<span><span class="co"># Estimates are the column means</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">results2</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span>, <span class="va">mean</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      beta0      beta1        tau   Variance     StdDev </span></span>
<span><span class="co">## 27.7619863 -0.0554732  0.3055647  3.5419578  1.8627159</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Also look at uncertainty</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">results2</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       beta0       beta1         tau    Variance      StdDev </span></span>
<span><span class="co">## 1.339327429 0.008712278 0.084838193 1.070089030 0.268923052</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">results2</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          beta0       beta1       tau Variance   StdDev</span></span>
<span><span class="co">## 2.5%  25.16694 -0.07283719 0.1603452 2.002122 1.414964</span></span>
<span><span class="co">## 97.5% 30.36258 -0.03852308 0.4994701 6.236545 2.497308</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Kernel density plots for beta0, beta1 and the residual standard</span></span>
<span><span class="co"># deviation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">results2</span><span class="op">$</span><span class="va">beta0</span>, bw <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Posterior density for beta0"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7"><div class="figcaption">plot of chunk unnamed-chunk-7</div>
</div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">results2</span><span class="op">$</span><span class="va">beta1</span>, bw <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Posterior density for beta1"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-7-2.png" alt="plot of chunk unnamed-chunk-7"><div class="figcaption">plot of chunk unnamed-chunk-7</div>
</div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">results2</span><span class="op">$</span><span class="va">StdDev</span>, bw <span class="op">=</span> <span class="fl">0.075</span><span class="op">)</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Posterior density for StdDev"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-7-3.png" alt="plot of chunk unnamed-chunk-7"><div class="figcaption">plot of chunk unnamed-chunk-7</div>
</div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot sampled series</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/ts.plot.html" class="external-link">ts.plot</a></span><span class="op">(</span><span class="va">results2</span><span class="op">$</span><span class="va">beta0</span>, ylab <span class="op">=</span> <span class="st">"beta0"</span>, xlab <span class="op">=</span> <span class="st">"Iteration"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-7-4.png" alt="plot of chunk unnamed-chunk-7"><div class="figcaption">plot of chunk unnamed-chunk-7</div>
</div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/ts.plot.html" class="external-link">ts.plot</a></span><span class="op">(</span><span class="va">results2</span><span class="op">$</span><span class="va">beta1</span>, ylab <span class="op">=</span> <span class="st">"beta1"</span>, xlab <span class="op">=</span> <span class="st">"Iteration"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-7-5.png" alt="plot of chunk unnamed-chunk-7"><div class="figcaption">plot of chunk unnamed-chunk-7</div>
</div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/ts.plot.html" class="external-link">ts.plot</a></span><span class="op">(</span><span class="va">results2</span><span class="op">$</span><span class="va">StdDev</span>, ylab <span class="op">=</span> <span class="st">"sigma"</span>, xlab <span class="op">=</span> <span class="st">"Iteration"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-7-6.png" alt="plot of chunk unnamed-chunk-7"><div class="figcaption">plot of chunk unnamed-chunk-7</div>
</div>
</details>
</li>
</ul>
</div>
</div>
</div>
<div class="section level2">
<h2 id="inla">INLA<a class="anchor" aria-label="anchor" href="#inla"></a>
</h2>
<p><code>INLA</code> (<a href="https://www.r-inla.org/" class="external-link uri">https://www.r-inla.org/</a>) is based on producing
(accurate) approximations to the marginal posterior distributions of the
model parameters. Although this can be enough most of the time, making
multivariate inference with <code>INLA</code> can be difficult or
impossible. However, in many cases this is not needed and
<code>INLA</code> can fit some classes of models in a fraction of the
time it takes with MCMC.</p>
<p>We can obtain Bayesian model fits without using MCMC with the INLA
software, implemented in R via the <code>INLA</code> package. If you do
not have this package installed already, as it is not on CRAN you will
need to install it via</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span></span>
<span>  <span class="st">"INLA"</span>,</span>
<span>  repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"repos"</span><span class="op">)</span>, INLA<span class="op">=</span><span class="st">"https://inla.r-inla-download.org/R/stable"</span><span class="op">)</span>,</span>
<span>  dep<span class="op">=</span><span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>After this, the package can be loaded into R:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="example-fake-news">Example: Fake News<a class="anchor" aria-label="anchor" href="#example-fake-news"></a>
</h3>
<p>This section is included here as a reminder, as we are going to
reanalyse this data set using <code>INLA</code>.</p>
<p>The <code>fake_news</code> data set in the <code>bayesrules</code>
package in <code>R</code> contains information about 150 news articles,
some real news and some fake news.</p>
<p>In this example, we will look at trying to predict whether an article
of news is fake or not given three explanatory variables.</p>
<p>We can use the following code to extract the variables we want from
the data set:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayes-rules.github.io/bayesrules/docs/" class="external-link">bayesrules</a></span><span class="op">)</span></span>
<span><span class="va">fakenews</span> <span class="op">&lt;-</span> <span class="va">fake_news</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"type"</span>,<span class="st">"title_has_excl"</span>,<span class="st">"title_words"</span>,<span class="st">"negative"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>The response variable <code>type</code> takes values
<code>fake</code> or <code>real</code>, which should be
self-explanatory. The three explanatory variables are:</p>
<ul>
<li><p><code>title_has_excl</code>, whether or not the article contains
an exclamation mark (values <code>TRUE</code> or
<code>FALSE</code>);</p></li>
<li><p><code>title_words</code>, the number of words in the title (a
positive integer); and</p></li>
<li><p><code>negative</code>, a sentiment rating, recorded on a
continuous scale.</p></li>
</ul>
<p>In the exercise to follow, we will examine whether the chance of an
article being fake news is related to the three covariates here.</p>
<p>Note that the variable <code>title_has_excl</code> will need to be
either replaced by or converted to a factor, for example</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fakenews</span><span class="op">$</span><span class="va">titlehasexcl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">fakenews</span><span class="op">$</span><span class="va">title_has_excl</span><span class="op">)</span></span></code></pre></div>
<p>Functions <code>summary</code> and <code>confint</code> produce a
summary (including parameter estimates etc) and confidence intervals for
the parameters, respectively.</p>
<p>Finally, we create a new version of the response variable of type
logical:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fakenews</span><span class="op">$</span><span class="va">typeFAKE</span> <span class="op">&lt;-</span> <span class="va">fakenews</span><span class="op">$</span><span class="va">type</span> <span class="op">==</span> <span class="st">"fake"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="exercises-1">Exercises<a class="anchor" aria-label="anchor" href="#exercises-1"></a>
</h3>
<ul>
<li>
<p>Perform an exploratory assessment of the fake news data set, in
particular looking at the possible relationships between the explanatory
variables and the fake/real response variable <code>typeFAKE</code>. You
may wish to use the R function <code><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot()</a></code> here.</p>
<details><summary><p>Solution</p>
</summary><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Is there a link between the fakeness and whether the title has an exclamation mark?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">fakenews</span><span class="op">$</span><span class="va">title_has_excl</span>, <span class="va">fakenews</span><span class="op">$</span><span class="va">typeFAKE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        </span></span>
<span><span class="co">##         FALSE TRUE</span></span>
<span><span class="co">##   FALSE    88   44</span></span>
<span><span class="co">##   TRUE      2   16</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For the quantitative variables, look at boxplots on fake vs real</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">fakenews</span><span class="op">$</span><span class="va">title_words</span> <span class="op">~</span> <span class="va">fakenews</span><span class="op">$</span><span class="va">typeFAKE</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13"><div class="figcaption">plot of chunk unnamed-chunk-13</div>
</div>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">fakenews</span><span class="op">$</span><span class="va">negative</span> <span class="op">~</span> <span class="va">fakenews</span><span class="op">$</span><span class="va">typeFAKE</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-13-2.png" alt="plot of chunk unnamed-chunk-13"><div class="figcaption">plot of chunk unnamed-chunk-13</div>
</div>
</details>
</li>
<li>
<p>Fit the Bayesian model without MCMC using <code>INLA</code>; note
that the summary output provides credible intervals for each parameter
to help us make inference. Also, in <code>INLA</code> a Binomial
response needs to be entered as type integer, so we need another
conversion:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fakenews</span><span class="op">$</span><span class="va">typeFAKE.int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">fakenews</span><span class="op">$</span><span class="va">typeFAKE</span><span class="op">)</span></span></code></pre></div>
<details><summary><p>Solution</p>
</summary><div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit model - note similarity with bayesx syntax</span></span>
<span><span class="va">inla.output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">typeFAKE.int</span> <span class="op">~</span> <span class="va">titlehasexcl</span> <span class="op">+</span> <span class="va">title_words</span> <span class="op">+</span> <span class="va">negative</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">fakenews</span>,</span>
<span>                    family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="co"># Summarise output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">inla.output</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Time used:</span></span>
<span><span class="co">##     Pre = 0.274, Running = 0.172, Post = 0.00536, Total = 0.452 </span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##                    mean    sd 0.025quant 0.5quant 0.975quant   mode kld</span></span>
<span><span class="co">## (Intercept)      -3.016 0.761     -4.507   -3.016     -1.525 -3.016   0</span></span>
<span><span class="co">## titlehasexclTRUE  2.680 0.791      1.131    2.680      4.230  2.680   0</span></span>
<span><span class="co">## title_words       0.116 0.058      0.002    0.116      0.230  0.116   0</span></span>
<span><span class="co">## negative          0.328 0.154      0.027    0.328      0.629  0.328   0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Marginal log-Likelihood:  -100.78 </span></span>
<span><span class="co">##  is computed </span></span>
<span><span class="co">## Posterior summaries for the linear predictor and the fitted values are computed</span></span>
<span><span class="co">## (Posterior marginals needs also 'control.compute=list(return.marginals.predictor=TRUE)')</span></span></code></pre>
</details>
</li>
<li>
<p>Fit a non-Bayesian model using <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> for comparison.
How do the model fits compare?</p>
<details><summary><p>Solution</p>
</summary><div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit model - note similarity with bayesx syntax</span></span>
<span><span class="va">glm.output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">typeFAKE</span> <span class="op">~</span> <span class="va">titlehasexcl</span> <span class="op">+</span> <span class="va">title_words</span> <span class="op">+</span> <span class="va">negative</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">fakenews</span>,</span>
<span>                  family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="co"># Summarise output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">glm.output</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## glm(formula = typeFAKE ~ titlehasexcl + title_words + negative, </span></span>
<span><span class="co">##     family = "binomial", data = fakenews)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                  Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept)      -2.91516    0.76096  -3.831 0.000128 ***</span></span>
<span><span class="co">## titlehasexclTRUE  2.44156    0.79103   3.087 0.002025 ** </span></span>
<span><span class="co">## title_words       0.11164    0.05801   1.925 0.054278 .  </span></span>
<span><span class="co">## negative          0.31527    0.15371   2.051 0.040266 *  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Null deviance: 201.90  on 149  degrees of freedom</span></span>
<span><span class="co">## Residual deviance: 169.36  on 146  degrees of freedom</span></span>
<span><span class="co">## AIC: 177.36</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of Fisher Scoring iterations: 4</span></span></code></pre>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Perform ANOVA on each variable in turn</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/add1.html" class="external-link">drop1</a></span><span class="op">(</span><span class="va">glm.output</span>,test<span class="op">=</span><span class="st">"Chisq"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Single term deletions</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model:</span></span>
<span><span class="co">## typeFAKE ~ titlehasexcl + title_words + negative</span></span>
<span><span class="co">##              Df Deviance    AIC     LRT  Pr(&gt;Chi)    </span></span>
<span><span class="co">## &lt;none&gt;            169.36 177.36                      </span></span>
<span><span class="co">## titlehasexcl  1   183.51 189.51 14.1519 0.0001686 ***</span></span>
<span><span class="co">## title_words   1   173.17 179.17  3.8099 0.0509518 .  </span></span>
<span><span class="co">## negative      1   173.79 179.79  4.4298 0.0353162 *  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre>
</details>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="example-emergency-room-complaints">Example: Emergency Room Complaints<a class="anchor" aria-label="anchor" href="#example-emergency-room-complaints"></a>
</h3>
<p>This section is included here as a reminder, as we are going to
reanalyse this data set using <code>INLA</code>.</p>
<p>For this example we will use the <code>esdcomp</code> data set, which
is available in the <code>faraway</code> package. This data set records
complaints about emergency room doctors. In particular, data was
recorded on 44 doctors working in an emergency service at a hospital to
study the factors affecting the number of complaints received.</p>
<p>The response variable that we will use is <code>complaints</code>, an
integer count of the number of complaints received. It is expected that
the number of complaints will scale by the number of visits (contained
in the <code>visits</code> column), so we are modelling the rate of
complaints per visit - thus we will need to include a new variable
<code>log.visits</code> as an offset.</p>
<p>The three explanatory variables we will use in the analysis are:</p>
<ul>
<li><p><code>residency</code>, whether or not the doctor is still in
residency training (values <code>N</code> or <code>Y</code>);</p></li>
<li><p><code>gender</code>, the gender of the doctor (values
<code>F</code> or <code>M</code>); and</p></li>
<li><p><code>revenue</code>, dollars per hour earned by the doctor,
recorded as an integer.</p></li>
</ul>
<p>Our simple aim here is to assess whether the seniority, gender or
income of the doctor is linked with the rate of complaints against that
doctor.</p>
<p>We can use the following code to extract the data we want without
having to load the whole package:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">esdcomp</span> <span class="op">&lt;-</span> <span class="fu">faraway</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/faraway/man/esdcomp.html" class="external-link">esdcomp</a></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitting-bayesian-poisson-regression-models">Fitting Bayesian Poisson Regression Models<a class="anchor" aria-label="anchor" href="#fitting-bayesian-poisson-regression-models"></a>
</h3>
<p>Again we can use <code>INLA</code> to fit this form of Bayesian
generalised linear model.</p>
<p>If not loaded already, the package must be loaded into R:</p>
<p>As noted above we need to include an offset in this analysis; since
for a Poisson GLM we will be using a log() link function by default, we
must compute the log of the number of visits and include that in the
data set <code>esdcomp</code>:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">esdcomp</span><span class="op">$</span><span class="va">log.visits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">esdcomp</span><span class="op">$</span><span class="va">visits</span><span class="op">)</span></span></code></pre></div>
<p>The offset term in the model is then written</p>
<p><code>offset(log.visits)</code></p>
</div>
<div class="section level3">
<h3 id="exercises-2">Exercises<a class="anchor" aria-label="anchor" href="#exercises-2"></a>
</h3>
<ul>
<li>
<p>Perform an exploratory assessment of the emergency room
complaints data set, particularly how the response variable
<code>complaints</code> varies with the proposed explanatory variables
relative to the number of visits. To do this, create another variable
which is the ratio of <code>complaints</code> to
<code>visits</code>.</p>
<details><summary><p>Solution</p>
</summary><div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute the ratio</span></span>
<span><span class="va">esdcomp</span><span class="op">$</span><span class="va">ratio</span> <span class="op">&lt;-</span> <span class="va">esdcomp</span><span class="op">$</span><span class="va">complaints</span> <span class="op">/</span> <span class="va">esdcomp</span><span class="op">$</span><span class="va">visits</span></span>
<span><span class="co"># Plot the link with revenue</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">esdcomp</span><span class="op">$</span><span class="va">revenue</span>,<span class="va">esdcomp</span><span class="op">$</span><span class="va">ratio</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-20-1.png" alt="plot of chunk unnamed-chunk-20"><div class="figcaption">plot of chunk unnamed-chunk-20</div>
</div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use boxplots against residency and gender</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">esdcomp</span><span class="op">$</span><span class="va">ratio</span> <span class="op">~</span> <span class="va">esdcomp</span><span class="op">$</span><span class="va">residency</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-20-2.png" alt="plot of chunk unnamed-chunk-20"><div class="figcaption">plot of chunk unnamed-chunk-20</div>
</div>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">esdcomp</span><span class="op">$</span><span class="va">ratio</span> <span class="op">~</span> <span class="va">esdcomp</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-20-3.png" alt="plot of chunk unnamed-chunk-20"><div class="figcaption">plot of chunk unnamed-chunk-20</div>
</div>
</details>
</li>
<li>
<p>Fit the Bayesian model without MCMC using <code>INLA</code>; note
that the summary output provides credible intervals for each parameter
to help us make inference.</p>
<details><summary><p>Solution</p>
</summary><div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit model - note similarity with bayesx syntax</span></span>
<span><span class="va">inla.output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">complaints</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="va">log.visits</span><span class="op">)</span> <span class="op">+</span> <span class="va">residency</span> <span class="op">+</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">revenue</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">esdcomp</span>,</span>
<span>                    family <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="co"># Summarise output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">inla.output</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Time used:</span></span>
<span><span class="co">##     Pre = 0.129, Running = 0.145, Post = 0.061, Total = 0.335 </span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##               mean    sd 0.025quant 0.5quant 0.975quant   mode kld</span></span>
<span><span class="co">## (Intercept) -7.171 0.688     -8.520   -7.171     -5.822 -7.171   0</span></span>
<span><span class="co">## residencyY  -0.354 0.191     -0.728   -0.354      0.021 -0.354   0</span></span>
<span><span class="co">## genderM      0.139 0.214     -0.281    0.139      0.559  0.139   0</span></span>
<span><span class="co">## revenue      0.002 0.003     -0.003    0.002      0.008  0.002   0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Marginal log-Likelihood:  -111.90 </span></span>
<span><span class="co">##  is computed </span></span>
<span><span class="co">## Posterior summaries for the linear predictor and the fitted values are computed</span></span>
<span><span class="co">## (Posterior marginals needs also 'control.compute=list(return.marginals.predictor=TRUE)')</span></span></code></pre>
</details>
</li>
<li>
<p>Fit a non-Bayesian model using <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> for comparison.
How do the model fits compare?</p>
<details><summary><p>Solution</p>
</summary><div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit model - note similarity with bayesx syntax</span></span>
<span><span class="va">esdcomp</span><span class="op">$</span><span class="va">log.visits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">esdcomp</span><span class="op">$</span><span class="va">visits</span><span class="op">)</span></span>
<span><span class="va">glm.output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">complaints</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="va">log.visits</span><span class="op">)</span> <span class="op">+</span> <span class="va">residency</span> <span class="op">+</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">revenue</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">esdcomp</span>,</span>
<span>                  family <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="co"># Summarise output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">glm.output</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## glm(formula = complaints ~ offset(log.visits) + residency + gender + </span></span>
<span><span class="co">##     revenue, family = "poisson", data = esdcomp)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##              Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept) -7.157087   0.688148 -10.401   &lt;2e-16 ***</span></span>
<span><span class="co">## residencyY  -0.350610   0.191077  -1.835   0.0665 .  </span></span>
<span><span class="co">## genderM      0.128995   0.214323   0.602   0.5473    </span></span>
<span><span class="co">## revenue      0.002362   0.002798   0.844   0.3986    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (Dispersion parameter for poisson family taken to be 1)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Null deviance: 63.435  on 43  degrees of freedom</span></span>
<span><span class="co">## Residual deviance: 58.698  on 40  degrees of freedom</span></span>
<span><span class="co">## AIC: 189.48</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of Fisher Scoring iterations: 5</span></span></code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Perform ANOVA on each variable in turn</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/add1.html" class="external-link">drop1</a></span><span class="op">(</span><span class="va">glm.output</span>, test <span class="op">=</span> <span class="st">"Chisq"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Single term deletions</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model:</span></span>
<span><span class="co">## complaints ~ offset(log.visits) + residency + gender + revenue</span></span>
<span><span class="co">##           Df Deviance    AIC    LRT Pr(&gt;Chi)  </span></span>
<span><span class="co">## &lt;none&gt;         58.698 189.48                  </span></span>
<span><span class="co">## residency  1   62.128 190.91 3.4303  0.06401 .</span></span>
<span><span class="co">## gender     1   59.067 187.85 0.3689  0.54361  </span></span>
<span><span class="co">## revenue    1   59.407 188.19 0.7093  0.39969  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre>
</details>
</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="bayesian-hierarchical-modelling">Bayesian Hierarchical Modelling<a class="anchor" aria-label="anchor" href="#bayesian-hierarchical-modelling"></a>
</h2>
<p>These two final sections simply reproduce Practical 7, but using
<code>INLA</code> rather than <code>BayesX</code>.</p>
</div>
<div class="section level2">
<h2 id="linear-mixed-models">Linear Mixed Models<a class="anchor" aria-label="anchor" href="#linear-mixed-models"></a>
</h2>
<p>Linear mixed models were defined in the lecture as follows:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>X</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mi>Î²</mi><mo>+</mo><msub><mi>Ï•</mi><mi>i</mi></msub><mo>+</mo><msub><mi>Ïµ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
Y_{ij} = X_{ij}\beta +\phi_i+\epsilon_{ij}
</annotation></semantics></math></p>
<p>Here,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">Y_{ij}</annotation></semantics></math>
represents observation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
in group
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">X_{ij}</annotation></semantics></math>
is a vector of covariates with coefficients
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î²</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ï•</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\phi_i</annotation></semantics></math>
i.i.d. random effects and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ïµ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\epsilon_{ij}</annotation></semantics></math>
a Gaussian error term. The distribution of the random effects
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ï•</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\phi_i</annotation></semantics></math>
is Gaussian with zero mean and precision
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ï„</mi><mi>Ï•</mi></msub><annotation encoding="application/x-tex">\tau_{\phi}</annotation></semantics></math>.</p>
</div>
<div class="section level2">
<h2 id="multilevel-modelling">Multilevel Modelling<a class="anchor" aria-label="anchor" href="#multilevel-modelling"></a>
</h2>
<p>Multilevel models are a particular type of mixed-effects models in
which observations are nested within groups, so that group effects are
modelled using random effects. A typical example is that of students
nested within classes.</p>
<p>For the next example, the <code>nlschools</code> data set (in package
<code>MASS</code>) will be used. This data set records data about
studentsâ€™ performance (in particular, about a language score test) and
other variables. The variables in this data set are:</p>
<ul>
<li><p><code>lang</code>, language score test.</p></li>
<li><p><code>IQ</code>, verbal IQ.</p></li>
<li><p><code>class</code>, class ID.</p></li>
<li><p><code>GS</code>, class size as number of eighth-grade pupils
recorded in the class.</p></li>
<li><p><code>SES</code>, social-economic status of pupilâ€™s
family.</p></li>
<li><p><code>COMB</code>, whether the pupils are taught in the
multi-grade class with 7th-grade students.</p></li>
</ul>
<p>The data set can be loaded and summarised as follows:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"nlschools"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">nlschools</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       lang             IQ            class            GS             SES        COMB    </span></span>
<span><span class="co">##  Min.   : 9.00   Min.   : 4.00   15580  :  33   Min.   :10.00   Min.   :10.00   0:1658  </span></span>
<span><span class="co">##  1st Qu.:35.00   1st Qu.:10.50   5480   :  31   1st Qu.:23.00   1st Qu.:20.00   1: 629  </span></span>
<span><span class="co">##  Median :42.00   Median :12.00   15980  :  31   Median :27.00   Median :27.00           </span></span>
<span><span class="co">##  Mean   :40.93   Mean   :11.83   16180  :  31   Mean   :26.51   Mean   :27.81           </span></span>
<span><span class="co">##  3rd Qu.:48.00   3rd Qu.:13.00   18380  :  31   3rd Qu.:31.00   3rd Qu.:35.00           </span></span>
<span><span class="co">##  Max.   :58.00   Max.   :18.00   5580   :  30   Max.   :39.00   Max.   :50.00           </span></span>
<span><span class="co">##                                  (Other):2100</span></span></code></pre>
<p>The model to fit will take <code>lang</code> as the response variable
and include <code>IQ</code>, <code>GS</code>, <code>SES</code> and
<code>COMB</code> as covariates (i.e., fixed effects). This model can
easily be fit with <code>INLA</code> as follows:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">lang</span> <span class="op">~</span> <span class="va">IQ</span> <span class="op">+</span> <span class="va">GS</span> <span class="op">+</span>  <span class="va">SES</span> <span class="op">+</span> <span class="va">COMB</span>, data <span class="op">=</span> <span class="va">nlschools</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Time used:</span></span>
<span><span class="co">##     Pre = 0.13, Running = 0.163, Post = 0.0111, Total = 0.305 </span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##               mean    sd 0.025quant 0.5quant 0.975quant   mode kld</span></span>
<span><span class="co">## (Intercept)  9.685 1.070      7.586    9.685     11.784  9.685   0</span></span>
<span><span class="co">## IQ           2.391 0.074      2.246    2.391      2.536  2.391   0</span></span>
<span><span class="co">## GS          -0.026 0.025     -0.076   -0.026      0.024 -0.026   0</span></span>
<span><span class="co">## SES          0.148 0.014      0.120    0.148      0.175  0.148   0</span></span>
<span><span class="co">## COMB1       -1.684 0.325     -2.322   -1.684     -1.047 -1.684   0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model hyperparameters:</span></span>
<span><span class="co">##                                          mean    sd 0.025quant 0.5quant 0.975quant  mode</span></span>
<span><span class="co">## Precision for the Gaussian observations 0.021 0.001       0.02    0.021      0.022 0.021</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Marginal log-Likelihood:  -7713.44 </span></span>
<span><span class="co">##  is computed </span></span>
<span><span class="co">## Posterior summaries for the linear predictor and the fitted values are computed</span></span>
<span><span class="co">## (Posterior marginals needs also 'control.compute=list(return.marginals.predictor=TRUE)')</span></span></code></pre>
<p>Note that the previous model only includes fixed effects. The data
set includes <code>class</code> as the class ID to which each student
belongs. Class effects can have an impact on the performance of the
students, with students in the same class performing similarly in the
language test.</p>
<p>Very conveniently, <code>INLA</code> can include random effects in
the model by adding a term in the right hand side of the formula that
defined the model. Specifically, the term to add is
<code>f(class, model = "iid")</code> (see code below for the full
model). This will create a random effect indexed over variable
<code>class</code> and which is of type <code>iid</code>, i.e., the
random effects are independent and identically distributed using a
normal distribution with zero mean and precision
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï„</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>.</p>
<p>Before fitting the model, the between-class variability can be
explored by means of boxplots:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">lang</span> <span class="op">~</span> <span class="va">class</span>, data <span class="op">=</span> <span class="va">nlschools</span>, las <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-25-1.png" alt="plot of chunk unnamed-chunk-25"><div class="figcaption">plot of chunk unnamed-chunk-25</div>
</div>
<p>The code to fit the model with random effects is:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span></span>
<span>  <span class="va">lang</span> <span class="op">~</span> <span class="va">IQ</span> <span class="op">+</span> <span class="va">GS</span> <span class="op">+</span>  <span class="va">SES</span> <span class="op">+</span> <span class="va">COMB</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">class</span>, model <span class="op">=</span> <span class="st">"iid"</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">nlschools</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Time used:</span></span>
<span><span class="co">##     Pre = 0.814, Running = 0.19, Post = 0.0219, Total = 1.03 </span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##               mean    sd 0.025quant 0.5quant 0.975quant   mode kld</span></span>
<span><span class="co">## (Intercept) 10.626 1.495      7.698   10.624     13.565 10.624   0</span></span>
<span><span class="co">## IQ           2.248 0.072      2.108    2.248      2.388  2.248   0</span></span>
<span><span class="co">## GS          -0.016 0.047     -0.109   -0.016      0.078 -0.016   0</span></span>
<span><span class="co">## SES          0.165 0.015      0.136    0.165      0.194  0.165   0</span></span>
<span><span class="co">## COMB1       -2.017 0.598     -3.193   -2.016     -0.847 -2.016   0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Random effects:</span></span>
<span><span class="co">##   Name     Model</span></span>
<span><span class="co">##     class IID model</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model hyperparameters:</span></span>
<span><span class="co">##                                          mean    sd 0.025quant 0.5quant 0.975quant  mode</span></span>
<span><span class="co">## Precision for the Gaussian observations 0.025 0.001      0.024    0.025      0.027 0.025</span></span>
<span><span class="co">## Precision for class                     0.122 0.020      0.087    0.121      0.167 0.118</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Marginal log-Likelihood:  -7613.01 </span></span>
<span><span class="co">##  is computed </span></span>
<span><span class="co">## Posterior summaries for the linear predictor and the fitted values are computed</span></span>
<span><span class="co">## (Posterior marginals needs also 'control.compute=list(return.marginals.predictor=TRUE)')</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="generalised-linear-mixed-models">Generalised Linear Mixed Models<a class="anchor" aria-label="anchor" href="#generalised-linear-mixed-models"></a>
</h2>
<p>Mixed effects models can also be considered within the context of
generalised linear models. In this case, the linear predictor of
observation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î·</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\eta_i</annotation></semantics></math>,
can be defined as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î·</mi><mi>i</mi></msub><mo>=</mo><msub><mi>X</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mi>Î²</mi><mo>+</mo><msub><mi>Ï•</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">
\eta_i = X_{ij}\beta +\phi_i
</annotation></semantics></math></p>
<p>Compared to the previous setting of linear mixed effects models, note
that now the distribution of the response could be other than Gaussian
and that observations are not necessarily nested within groups.</p>
</div>
<div class="section level2">
<h2 id="poisson-regression">Poisson regression<a class="anchor" aria-label="anchor" href="#poisson-regression"></a>
</h2>
<p>In this practical we will use the North Carolina Sudden Infant Death
Syndrome (SIDS) data set. It is available in the <code>spData</code>
package and it can be loaded using:</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jakubnowosad.com/spData/" class="external-link">spData</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">nc.sids</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">nc.sids</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     CNTY.ID         BIR74           SID74          NWBIR74           BIR79           SID79      </span></span>
<span><span class="co">##  Min.   :1825   Min.   :  248   Min.   : 0.00   Min.   :   1.0   Min.   :  319   Min.   : 0.00  </span></span>
<span><span class="co">##  1st Qu.:1902   1st Qu.: 1077   1st Qu.: 2.00   1st Qu.: 190.0   1st Qu.: 1336   1st Qu.: 2.00  </span></span>
<span><span class="co">##  Median :1982   Median : 2180   Median : 4.00   Median : 697.5   Median : 2636   Median : 5.00  </span></span>
<span><span class="co">##  Mean   :1986   Mean   : 3300   Mean   : 6.67   Mean   :1051.0   Mean   : 4224   Mean   : 8.36  </span></span>
<span><span class="co">##  3rd Qu.:2067   3rd Qu.: 3936   3rd Qu.: 8.25   3rd Qu.:1168.5   3rd Qu.: 4889   3rd Qu.:10.25  </span></span>
<span><span class="co">##  Max.   :2241   Max.   :21588   Max.   :44.00   Max.   :8027.0   Max.   :30757   Max.   :57.00  </span></span>
<span><span class="co">##     NWBIR79             east           north             x                 y       </span></span>
<span><span class="co">##  Min.   :    3.0   Min.   : 19.0   Min.   :  6.0   Min.   :-328.04   Min.   :3757  </span></span>
<span><span class="co">##  1st Qu.:  250.5   1st Qu.:178.8   1st Qu.: 97.0   1st Qu.: -60.55   1st Qu.:3920  </span></span>
<span><span class="co">##  Median :  874.5   Median :285.0   Median :125.5   Median : 114.38   Median :3963  </span></span>
<span><span class="co">##  Mean   : 1352.8   Mean   :271.3   Mean   :122.1   Mean   :  91.46   Mean   :3953  </span></span>
<span><span class="co">##  3rd Qu.: 1406.8   3rd Qu.:361.2   3rd Qu.:151.5   3rd Qu.: 240.03   3rd Qu.:4000  </span></span>
<span><span class="co">##  Max.   :11631.0   Max.   :482.0   Max.   :182.0   Max.   : 439.65   Max.   :4060  </span></span>
<span><span class="co">##       lon              lat             L.id           M.id     </span></span>
<span><span class="co">##  Min.   :-84.08   Min.   :33.92   Min.   :1.00   Min.   :1.00  </span></span>
<span><span class="co">##  1st Qu.:-81.20   1st Qu.:35.26   1st Qu.:1.00   1st Qu.:2.00  </span></span>
<span><span class="co">##  Median :-79.26   Median :35.68   Median :2.00   Median :3.00  </span></span>
<span><span class="co">##  Mean   :-79.51   Mean   :35.62   Mean   :2.12   Mean   :2.67  </span></span>
<span><span class="co">##  3rd Qu.:-77.87   3rd Qu.:36.05   3rd Qu.:3.00   3rd Qu.:3.25  </span></span>
<span><span class="co">##  Max.   :-75.67   Max.   :36.52   Max.   :4.00   Max.   :4.00</span></span></code></pre>
<p>A full description of the data set is provided in the associated
manual page (check with <code><a href="https://jakubnowosad.com/spData/reference/nc.sids.html" class="external-link">?nc.sids</a></code>) but in this practical we
will only consider these variables:</p>
<ul>
<li><p><code>BIR74</code>, number of births (1974-78).</p></li>
<li><p><code>SID74</code>, number of SID deaths (1974-78).</p></li>
<li><p><code>NWBIR74</code>, number of non-white births
(1974-78).</p></li>
</ul>
<p>These variables are measured at the county level in North Carolina,
of which there are 100.</p>
<p>Because <code>SID74</code> records the number of SID deaths, the
model is Poisson:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>O</mi><mi>i</mi></msub><mo>âˆ£</mo><msub><mi>Î¼</mi><mi>i</mi></msub><mo>âˆ¼</mo><mi>P</mi><mi>o</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¼</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="0.222em"></mspace><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>â€¦</mi><mo>,</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">
O_i \mid \mu_i \sim Po(\mu_i),\ i=1,\ldots, 100
</annotation></semantics></math> Here,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>O</mi><mi>i</mi></msub><annotation encoding="application/x-tex">O_i</annotation></semantics></math>
represents the number of cases in county
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¼</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mu_i</annotation></semantics></math>
the mean. In addition, mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¼</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mu_i</annotation></semantics></math>
will be written as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¼</mi><mi>i</mi></msub><mo>=</mo><msub><mi>E</mi><mi>i</mi></msub><msub><mi>Î¸</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\mu_i = E_i \theta_i</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>E</mi><mi>i</mi></msub><annotation encoding="application/x-tex">E_i</annotation></semantics></math>
is the <em>expected</em> number of cases and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¸</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\theta_i</annotation></semantics></math>
the relative risk in county
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>.</p>
<p>The relative risk
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¸</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\theta_i</annotation></semantics></math>
is often modelled, on the log-scale, to be equal to a linear
predictor:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¸</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Î²</mi><mn>0</mn></msub><mo>+</mo><mi>â€¦</mi></mrow><annotation encoding="application/x-tex">
\log(\theta_i) = \beta_0 + \ldots
</annotation></semantics></math></p>
<p>The expected number of cases is computed by multiplying the number of
births in county
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
to the overall mortality rate</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>=</mo><mfrac><mrow><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mn>100</mn></munderover><msub><mi>O</mi><mi>i</mi></msub></mrow><mrow><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mn>100</mn></munderover><msub><mi>B</mi><mi>i</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">
r = \frac{\sum_{i=1}^{100}O_i}{\sum_{i=1}^{100}B_i}
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mi>i</mi></msub><annotation encoding="application/x-tex">B_i</annotation></semantics></math>
represents the total number of births in country
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>.
Hence, the expected number of cases in county
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mi>i</mi></msub><mo>=</mo><mi>r</mi><msub><mi>B</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">E_i = r B_i</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Overall mortality rate</span></span>
<span><span class="va">r74</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">nc.sids</span><span class="op">$</span><span class="va">SID74</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">nc.sids</span><span class="op">$</span><span class="va">BIR74</span><span class="op">)</span></span>
<span><span class="co"># Expected cases</span></span>
<span><span class="va">nc.sids</span><span class="op">$</span><span class="va">EXP74</span> <span class="op">&lt;-</span> <span class="va">r74</span> <span class="op">*</span> <span class="va">nc.sids</span><span class="op">$</span><span class="va">BIR74</span></span></code></pre></div>
<p>A common measure of relative risk is the <em>standardised mortality
ratio</em>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>O</mi><mi>i</mi></msub><mi>/</mi><msub><mi>E</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">O_i / E_i</annotation></semantics></math>):</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nc.sids</span><span class="op">$</span><span class="va">SMR74</span> <span class="op">&lt;-</span> <span class="va">nc.sids</span><span class="op">$</span><span class="va">SID74</span> <span class="op">/</span> <span class="va">nc.sids</span><span class="op">$</span><span class="va">EXP74</span></span></code></pre></div>
<p>A summary of the SMR can be obtained:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">nc.sids</span><span class="op">$</span><span class="va">SMR</span>, xlab <span class="op">=</span> <span class="st">"SMR"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-30-1.png" alt="plot of chunk unnamed-chunk-30"><div class="figcaption">plot of chunk unnamed-chunk-30</div>
</div>
<p>Values above 1 indicate that the county has more observed deaths than
expected and that there might be an increased risk in the area.</p>
<p>As a covariate, we will compute the proportion of non-white
births:</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nc.sids</span><span class="op">$</span><span class="va">NWPROP74</span> <span class="op">&lt;-</span> <span class="va">nc.sids</span><span class="op">$</span><span class="va">NWBIR74</span><span class="op">/</span> <span class="va">nc.sids</span><span class="op">$</span><span class="va">BIR74</span></span></code></pre></div>
<p>There is a clear relationship between the SMR and the proportion of
non-white births in a county:</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nc.sids</span><span class="op">$</span><span class="va">NWPROP74</span>, <span class="va">nc.sids</span><span class="op">$</span><span class="va">SMR74</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-32-1.png" alt="plot of chunk unnamed-chunk-32"><div class="figcaption">plot of chunk unnamed-chunk-32</div>
</div>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Correlation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">nc.sids</span><span class="op">$</span><span class="va">NWPROP74</span>, <span class="va">nc.sids</span><span class="op">$</span><span class="va">SMR74</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.5793901</span></span></code></pre>
<p>A simple Poisson regression can be fit by using the following
code:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1nc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span></span>
<span>  <span class="va">SID74</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">NWPROP74</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>  E <span class="op">=</span> <span class="va">nc.sids</span><span class="op">$</span><span class="va">EXP74</span>,</span>
<span>  data <span class="op">=</span> <span class="va">nc.sids</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m1nc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Time used:</span></span>
<span><span class="co">##     Pre = 0.314, Running = 0.148, Post = 0.00488, Total = 0.467 </span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##               mean    sd 0.025quant 0.5quant 0.975quant   mode kld</span></span>
<span><span class="co">## (Intercept) -0.647 0.090     -0.824   -0.647     -0.471 -0.647   0</span></span>
<span><span class="co">## NWPROP74     1.867 0.217      1.441    1.867      2.293  1.867   0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Marginal log-Likelihood:  -226.13 </span></span>
<span><span class="co">##  is computed </span></span>
<span><span class="co">## Posterior summaries for the linear predictor and the fitted values are computed</span></span>
<span><span class="co">## (Posterior marginals needs also 'control.compute=list(return.marginals.predictor=TRUE)')</span></span></code></pre>
<p>Random effects can also be included to account for intrinsic
differences between the counties:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Index for random effects</span></span>
<span><span class="va">nc.sids</span><span class="op">$</span><span class="va">ID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">nc.sids</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Model WITH covariate</span></span>
<span><span class="va">m2nc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span></span>
<span>  <span class="va">SID74</span> <span class="op">~</span>  <span class="fl">1</span> <span class="op">+</span> <span class="va">NWPROP74</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">ID</span>, model <span class="op">=</span> <span class="st">"iid"</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>  E <span class="op">=</span> <span class="va">nc.sids</span><span class="op">$</span><span class="va">EXP74</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">nc.sids</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m2nc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Time used:</span></span>
<span><span class="co">##     Pre = 0.138, Running = 0.157, Post = 0.00974, Total = 0.305 </span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##               mean    sd 0.025quant 0.5quant 0.975quant   mode kld</span></span>
<span><span class="co">## (Intercept) -0.650 0.104     -0.856   -0.649     -0.446 -0.649   0</span></span>
<span><span class="co">## NWPROP74     1.883 0.254      1.386    1.882      2.385  1.882   0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Random effects:</span></span>
<span><span class="co">##   Name     Model</span></span>
<span><span class="co">##     ID IID model</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model hyperparameters:</span></span>
<span><span class="co">##                   mean     sd 0.025quant 0.5quant 0.975quant  mode</span></span>
<span><span class="co">## Precision for ID 89.43 142.78       9.45    28.92     273.93 15.69</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Marginal log-Likelihood:  -227.82 </span></span>
<span><span class="co">##  is computed </span></span>
<span><span class="co">## Posterior summaries for the linear predictor and the fitted values are computed</span></span>
<span><span class="co">## (Posterior marginals needs also 'control.compute=list(return.marginals.predictor=TRUE)')</span></span></code></pre>
<p>The role of the covariate can be explored by fitting a model without
it:</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Model WITHOUT covariate</span></span>
<span><span class="va">m3nc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span></span>
<span>  <span class="va">SID74</span> <span class="op">~</span>  <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">ID</span>, model <span class="op">=</span> <span class="st">"iid"</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>  E <span class="op">=</span> <span class="va">nc.sids</span><span class="op">$</span><span class="va">EXP74</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">nc.sids</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m3nc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Time used:</span></span>
<span><span class="co">##     Pre = 0.145, Running = 0.166, Post = 0.00903, Total = 0.32 </span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##               mean    sd 0.025quant 0.5quant 0.975quant   mode kld</span></span>
<span><span class="co">## (Intercept) -0.029 0.063     -0.156   -0.028      0.091 -0.028   0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Random effects:</span></span>
<span><span class="co">##   Name     Model</span></span>
<span><span class="co">##     ID IID model</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model hyperparameters:</span></span>
<span><span class="co">##                  mean   sd 0.025quant 0.5quant 0.975quant mode</span></span>
<span><span class="co">## Precision for ID 7.26 2.57       3.79     6.77      13.55 6.01</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Marginal log-Likelihood:  -245.52 </span></span>
<span><span class="co">##  is computed </span></span>
<span><span class="co">## Posterior summaries for the linear predictor and the fitted values are computed</span></span>
<span><span class="co">## (Posterior marginals needs also 'control.compute=list(return.marginals.predictor=TRUE)')</span></span></code></pre>
<p>Now, notice the decrease in the estimate of the precision of the
random effects (i.e., the variance increases). This means that values of
the random effects are now larger than in the previous case as the
random effects pick some of the effect explained by the covariate.</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">m2nc</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">ID</span><span class="op">$</span><span class="va">mean</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"With NWPROP74"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">m3nc</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">ID</span><span class="op">$</span><span class="va">mean</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Without NWPROP74"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/unnamed-chunk-36-1.png" alt="plot of chunk unnamed-chunk-36"><div class="figcaption">plot of chunk unnamed-chunk-36</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by VIBASS Team, Facundo MuÃ±oz.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>

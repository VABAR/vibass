<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Practical 8: Bayesian hierachical models â€¢ vibass</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Practical 8: Bayesian hierachical models">
<meta property="og:description" content="vibass">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vibass</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.26</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/p1.html">Practical 1: Binary data</a>
    </li>
    <li>
      <a href="../articles/p2.html">Practical 2: Inference with simulated samples</a>
    </li>
    <li>
      <a href="../articles/p3.html">Practical 3: Count data</a>
    </li>
    <li>
      <a href="../articles/p4.html">Practical 4: Normal data</a>
    </li>
    <li>
      <a href="../articles/p5.html">Practical 5: Numerical approaches</a>
    </li>
    <li>
      <a href="../articles/p5_solutions.html">Solutions 5: Numerical approaches</a>
    </li>
    <li>
      <a href="../articles/p6.html">Practical 6: Linear models</a>
    </li>
    <li>
      <a href="../articles/p6_solutions.html">Solutions 6: Linear models</a>
    </li>
    <li>
      <a href="../articles/p7.html">Practical 7: Generalized linear models</a>
    </li>
    <li>
      <a href="../articles/p7_solutions.html">Solutions 7: Generalized linear models</a>
    </li>
    <li>
      <a href="../articles/p8.html">Practical 8: Bayesian hierachical models</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/VABAR/vibass/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="p8_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Practical 8: Bayesian hierachical models</h1>
                        <h4 data-toc-skip class="author">VIBASS</h4>
            
            <h4 data-toc-skip class="date">July 2022</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/VABAR/vibass/blob/HEAD/vignettes/p8.Rmd" class="external-link"><code>vignettes/p8.Rmd</code></a></small>
      <div class="hidden name"><code>p8.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>So far, only simple Bayesian models with conjugate priors have been considered. As explained in previous practicals, when the posterior distribution is not available in closed form, the Metropolis-Hastings algorithm can be used to obtain samples from it. In general, posterior distributions are seldom available in closed form and implementing the Metropolis-Hastings algorithm for complex models can be tricky.</p>
<p>For this reason, in this practical several <code>R</code> packages to fit Bayesian hierarchical models will be explored. The examples that have been considered in previous practicals will be revisited, but the computational tools discussed now can be used to deal with more complex models.</p>
<p>In particular, the following two software packages will be considered:</p>
<ul>
<li><p><code>BayesX</code></p></li>
<li><p><code>INLA</code></p></li>
</ul>
<p><code>BayesX</code> (<a href="http://www.bayesx.org/" class="external-link uri">http://www.bayesx.org/</a>) implements MCMC methods to obtain samples from the joint posterior and is more conveniently used from R using the package <code>R2BayesX</code>.</p>
<p><code>INLA</code> (<a href="https://www.r-inla.org/" class="external-link uri">https://www.r-inla.org/</a>) is based on producing (accurate) approximations to the marginal distributions of the model parameters. Although this can be enough most of the time, making multivariate inference with <code>INLA</code> can be difficult or impossible. However, in many cases this is not needed and <code>INLA</code> can fit some classes of models in a fraction of the time it takes with MCMC.</p>
<p>Both <code>R2BayesX</code> and <code>INLA</code> have a very simple interface to define models using a <code>formula</code> (in the same way as with <code>glm</code> and <code>gam</code>).</p>
<p>While <code>R2BayesX</code> can be installed from CRAN, <code>INLA</code> is not on CRAN and needs to be installed from a specific repository.</p>
</div>
<div class="section level2">
<h2 id="bayesx">
<code>BayesX</code><a class="anchor" aria-label="anchor" href="#bayesx"></a>
</h2>
<div class="section level3">
<h3 id="binomial-model">Binomial model<a class="anchor" aria-label="anchor" href="#binomial-model"></a>
</h3>
<p>The model that we will be using now is slightly different from the one presented in previous practicals. In particular, instead of a Binomial we will consider each one of the Bernoulli trials, so that data is encoded as <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span> and the model becomes:</p>
<p><span class="math display">\[
\begin{array}{rcl}
y_{ij} \mid \theta &amp; \sim &amp; Bi(1,\theta)\\
\textrm{logit}(\theta) &amp; = &amp; \beta_0\\
\beta_0 &amp; \sim &amp; N(0, \tau_{\beta_0})
\end{array}
\]</span></p>
<p>Note that now the probability <span class="math inline">\(\theta\)</span> is not modeled directly but that its logit depends on a linear predictor, which is made of a single intercept term <span class="math inline">\(\beta_0\)</span>. This term is assigned a (vague) Gaussian prior.</p>
<p>You can use the data from the proportion of red M&amp;Ms obtained before:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>MMs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">35</span>, <span class="fl">36</span>, <span class="fl">35</span><span class="op">)</span>, red <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Before fitting the model, you will need to transform the original data into binary data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">red.bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">red</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">MMs</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">red</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>As mentioned above, fitting a model with <code>BayesX</code> is similar to fitting a model with the <code>glm</code> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">R2BayesX</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: BayesXsrc</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: colorspace</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: mgcv</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: nlme</span></span></code></pre>
<pre><code><span><span class="co">## This is mgcv 1.8-40. For overview type 'help("mgcv-package")'.</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bayesx.bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/R2BayesX/man/bayesx.html" class="external-link">bayesx</a></span><span class="op">(</span><span class="va">red.bin</span> <span class="op">~</span> <span class="fl">1</span>, family <span class="op">=</span> <span class="st">"binomial"</span>, method <span class="op">=</span> <span class="st">"MCMC"</span><span class="op">)</span></span></code></pre></div>
<p>Note option <code>method = "MCMC"</code> which is needed to use MCMC to fit a Bayesian model. <code>BayesX</code> also supports restricted maximum likelihood (REML) and penalized least squares (PLS). Summary results can be displayed as follows:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bayesx.bin</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Call:</span></span>
<span><span class="co">## bayesx(formula = red.bin ~ 1, family = "binomial", method = "MCMC")</span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## Fixed effects estimation results:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parametric coefficients:</span></span>
<span><span class="co">##                Mean      Sd    2.5%     50%   97.5%</span></span>
<span><span class="co">## (Intercept) -1.3674  0.2459 -1.8773 -1.3532 -0.8944</span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## family = binomial  method = MCMC  N = 106  iterations = 12000  </span></span>
<span><span class="co">## burnin = 2000  step = 10</span></span></code></pre>
<p>Note that the output shows the summary of the intercept term <span class="math inline">\(\beta_0\)</span> and not of <span class="math inline">\(\theta\)</span>. In this simple case, we can obtain a sample from the posterior of <span class="math inline">\(\theta\)</span> by back-transforming the samples of the intercept term, i.e., <span class="math inline">\(\theta = \textrm{expit}(\beta_0) = 1/(1 + \exp(-\beta_0))\)</span>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bayesx.theta</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bayesx.bin</span><span class="op">$</span><span class="va">fixed.effects</span>, <span class="st">"sample"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bayesx.theta</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">## 0.09782 0.17848 0.20535 0.20590 0.23080 0.34016</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bayesx.theta</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"MCMC samples"</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">bayesx.theta</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Posterior density"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="p8_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="poisson-model">Poisson model<a class="anchor" aria-label="anchor" href="#poisson-model"></a>
</h3>
<p>A Poisson model has already been used for the <em>Game of Thrones</em> data set. In this case, a slightly different model will be fitted:</p>
<p><span class="math display">\[
\begin{array}{rcl}
y_i \mid \lambda &amp; \sim &amp; Po(\lambda)\\
\log(\lambda) &amp; = &amp; \beta_0\\
\beta_0 &amp; \sim &amp; N(0, \tau_{\beta_0})
\end{array}
\]</span></p>
<p>In BayesX, <span class="math inline">\(\tau_{\beta_0}\)</span> is assigned a Gamma prior with parameters 0.001 and 0.001, but we will ignore that for now.</p>
<p>This is often called a <em>Poisson model</em> or <em>log-linear model</em> because the logarithm of the mean (i.e., <span class="math inline">\(\lambda\)</span>) is modeled on a vector of covariates. In this case the linear predictor is made up of a single intercept term, which is assigned a Gaussian prior.</p>
<p>To fit this model, use the data collected previously, which can be loaded with:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Us <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">29</span>, <span class="fl">27</span>, <span class="fl">27</span>, <span class="fl">25</span>, <span class="fl">27</span>, <span class="fl">22</span>, <span class="fl">26</span>, <span class="fl">27</span>, <span class="fl">29</span>, <span class="fl">23</span>, <span class="fl">28</span>, <span class="fl">25</span>,</span>
<span>  <span class="fl">24</span>, <span class="fl">22</span>, <span class="fl">25</span>, <span class="fl">23</span>, <span class="fl">29</span>, <span class="fl">23</span>, <span class="fl">28</span>, <span class="fl">21</span>, <span class="fl">29</span>, <span class="fl">28</span>, <span class="fl">23</span>, <span class="fl">28</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Us</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">Us</span></span></code></pre></div>
<p>Fitting this model with <code>BayesX</code> is very easy:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bayesx.pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/R2BayesX/man/bayesx.html" class="external-link">bayesx</a></span><span class="op">(</span><span class="va">Us</span> <span class="op">~</span> <span class="fl">1</span>, family <span class="op">=</span> <span class="st">"poisson"</span>, method <span class="op">=</span> <span class="st">"MCMC"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bayesx.pois</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Call:</span></span>
<span><span class="co">## bayesx(formula = Us ~ 1, family = "poisson", method = "MCMC")</span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## Fixed effects estimation results:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parametric coefficients:</span></span>
<span><span class="co">##               Mean     Sd   2.5%    50%  97.5%</span></span>
<span><span class="co">## (Intercept) 3.2465 0.0381 3.1642 3.2480 3.3193</span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## family = poisson  method = MCMC  N = 25  iterations = 12000  </span></span>
<span><span class="co">## burnin = 2000  step = 10</span></span></code></pre>
<p>Note that the output shows the summary of the intercept term <span class="math inline">\(\beta_0\)</span> and not of <span class="math inline">\(\lambda\)</span>. In this simple case, we can obtain a sample from the posterior of <span class="math inline">\(\lambda\)</span> by back-transforming the samples of the intercept term, i.e., <span class="math inline">\(\lambda = \exp(\beta_0)\)</span>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bayesx.lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bayesx.pois</span><span class="op">$</span><span class="va">fixed.effects</span>, <span class="st">"sample"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bayesx.lambda</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">##   22.85   25.05   25.74   25.72   26.41   29.25</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bayesx.lambda</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"MCMC samples"</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">bayesx.lambda</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Posterior density"</span>, xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="p8_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="normal-model">Normal model<a class="anchor" aria-label="anchor" href="#normal-model"></a>
</h3>
<p>The final model is based on the height data collected before. The actual model that will be considered is:</p>
<p><span class="math display">\[
\begin{array}{rcl}
y_i \mid \mu, \tau&amp; \sim &amp; N(\mu, \tau)\\
\mu &amp; = &amp; \beta_0\\
\beta_0 &amp; \sim &amp; N(0, \tau_{\beta_0})\\
\tau &amp; \sim &amp; Ga(0.001, 0.001)
\end{array}
\]</span></p>
<p>In this case, we have explicitly written the mean <span class="math inline">\(\mu\)</span> equal to a linear predictor because this model can be generalised to include additive effects on several covariates.</p>
<p>You can load the height data using this:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.6</span>, <span class="fl">1.62</span>, <span class="fl">1.69</span>, <span class="fl">1.58</span>, <span class="fl">1.57</span>, <span class="fl">1.57</span>, <span class="fl">1.47</span>, <span class="fl">1.59</span>,</span>
<span>  <span class="fl">1.59</span>, <span class="fl">1.66</span>, <span class="fl">1.59</span>, <span class="fl">1.73</span>, <span class="fl">1.61</span>, <span class="fl">1.59</span>, <span class="fl">1.73</span>, <span class="fl">1.92</span>, <span class="fl">1.74</span>, <span class="fl">1.82</span>, <span class="fl">1.74</span>, <span class="fl">1.82</span>, <span class="fl">1.89</span>,</span>
<span>  <span class="fl">1.96</span>, <span class="fl">1.83</span>, <span class="fl">1.81</span>, <span class="fl">1.74</span>, <span class="fl">1.75</span>, <span class="fl">1.9</span>, <span class="fl">1.69</span>, <span class="fl">1.92</span>, <span class="fl">1.77</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">heights</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">height</span></span></code></pre></div>
<p>Similarly as in the previous examples, the model can be fitted as:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bayesx.norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/R2BayesX/man/bayesx.html" class="external-link">bayesx</a></span><span class="op">(</span><span class="va">heights</span> <span class="op">~</span> <span class="fl">1</span>, family <span class="op">=</span> <span class="st">"gaussian"</span>, method <span class="op">=</span> <span class="st">"MCMC"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bayesx.norm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Call:</span></span>
<span><span class="co">## bayesx(formula = heights ~ 1, family = "gaussian", method = "MCMC")</span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## Fixed effects estimation results:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parametric coefficients:</span></span>
<span><span class="co">##               Mean     Sd   2.5%    50%  97.5%</span></span>
<span><span class="co">## (Intercept) 1.7171 0.0247 1.6694 1.7174 1.7692</span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## Scale estimate:</span></span>
<span><span class="co">##          Mean     Sd   2.5%    50%  97.5%</span></span>
<span><span class="co">## Sigma2 0.0178 0.0051 0.0104 0.0170 0.0305</span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## family = gaussian  method = MCMC  N = 30  iterations = 12000  </span></span>
<span><span class="co">## burnin = 2000  step = 10</span></span></code></pre>
<p>In this case, mean <span class="math inline">\(\mu\)</span> is equal to <span class="math inline">\(\beta_0\)</span>, so there is no need to make any transformation. However, <code>BayesX</code> reports the variance, so we need to take the inverse of the samples in order to estimate the precision:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bayesx.mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bayesx.norm</span><span class="op">$</span><span class="va">fixed.effects</span>, <span class="st">"sample"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">bayesx.tau</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bayesx.norm</span><span class="op">$</span><span class="va">variance</span>, <span class="st">"sample"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bayesx.mu</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"MCMC samples"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">bayesx.mu</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Posterior density"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bayesx.tau</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"MCMC samples"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">tau</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">bayesx.tau</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Posterior density"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">tau</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="p8_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="inla">
<code>INLA</code><a class="anchor" aria-label="anchor" href="#inla"></a>
</h2>
<p>The <code>R-INLA</code> package is an implementation of the <em>integrated nested Laplace approximation</em> method in <code>R</code>. This method is based on obtaining accurate approximations to the posterior marginals of the model parameters using different numerical approximations with the Laplace method.</p>
<p>Model-fitting with <code>R-INLA</code> is very similar to model-fitting with <code>BayesX</code>. Instead of calling <code><a href="https://rdrr.io/pkg/R2BayesX/man/bayesx.html" class="external-link">bayesx()</a></code>, you will be calling <code><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla()</a></code>. Of course there are important differences between these two packages but, in practice, the process of fitting models works in a very similar way.</p>
<div class="section level3">
<h3 id="binomial-model-1">Binomial model<a class="anchor" aria-label="anchor" href="#binomial-model-1"></a>
</h3>
<p>First, a model to the M&amp;Ms data set will be fitted:</p>
<pre><code><span><span class="co">## Loading required package: INLA</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: Matrix</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: sp</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: parallel</span></span></code></pre>
<pre><code><span><span class="co">## This is INLA_19.09.03 built 2022-07-10 17:36:15 UTC.</span></span>
<span><span class="co">## See www.r-inla.org/contact-us for how to get help.</span></span>
<span><span class="co">## To enable PARDISO sparse library; see inla.pardiso()</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span>
<span><span class="va">inla.bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">red.bin</span> <span class="op">~</span> <span class="fl">1</span>, family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>red.bin <span class="op">=</span> <span class="va">red.bin</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">inla.bin</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in length(alist[[idx]]) &gt; 0 &amp;&amp; !is.null(alist[[idx]]) &amp;&amp; !</span></span>
<span><span class="co">## is.na(alist[[idx]]): 'length(x) = 4 &gt; 1' in coercion to 'logical(1)'</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">##    "inla(formula = red.bin ~ 1, family = \"binomial\", data = list(red.bin </span></span>
<span><span class="co">##    = red.bin))" </span></span>
<span><span class="co">## Time used:</span></span>
<span><span class="co">##     Pre = 1.48, Running = 0.692, Post = 0.0987, Total = 2.27</span></span></code></pre>
<pre><code><span><span class="co">## Warning in length(alist[[idx]]) &gt; 0 &amp;&amp; !is.null(alist[[idx]]) &amp;&amp; !</span></span>
<span><span class="co">## is.na(alist[[idx]]): 'length(x) = 7 &gt; 1' in coercion to 'logical(1)'</span></span></code></pre>
<pre><code><span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##              mean    sd 0.025quant 0.5quant 0.975quant   mode kld</span></span>
<span><span class="co">## (Intercept) -1.34 0.239     -1.828   -1.334     -0.888 -1.321   0</span></span></code></pre>
<pre><code><span><span class="co">## Warning in length(alist[[idx]]) &gt; 0 &amp;&amp; !is.null(alist[[idx]]) &amp;&amp; !</span></span>
<span><span class="co">## is.na(alist[[idx]]): 'length(x) = 3 &gt; 1' in coercion to 'logical(1)'</span></span></code></pre>
<pre><code><span><span class="co">## Expected number of effective parameters(stdev): 1.00(0.00)</span></span>
<span><span class="co">## Number of equivalent replicates : 105.99</span></span></code></pre>
<pre><code><span><span class="co">## Warning in length(alist[[idx]]) &gt; 0 &amp;&amp; !is.null(alist[[idx]]) &amp;&amp; !</span></span>
<span><span class="co">## is.na(alist[[idx]]): 'length(x) = 2 &gt; 1' in coercion to 'logical(1)'</span></span></code></pre>
<pre><code><span><span class="co">## Marginal log-Likelihood:  -54.64</span></span></code></pre>
<p>The output shows summary statistics of the intercept, which is not the proportion. We need to back-transform the output but, in this case, we need to back-transform the marginal distribution of the intercept (because there are no samples from the posterior):</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">marg.theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>, </span>
<span>  <span class="va">inla.bin</span><span class="op">$</span><span class="va">marginals.fixed</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Here, function <code>inla.tmarginal</code> will take the posterior marginal of a parameter and compute the marginal of a transformation of this parameter. In this case, we have the marginal of <span class="math inline">\(\beta_0\)</span> and we compute the marginal of the transformed value <span class="math inline">\(\theta = \textrm{expit}(\beta_0) = 1 / (1 + \exp(-\beta_0))\)</span>:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">marg.theta</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"Posterior density"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="st">"density"</span><span class="op">)</span></span></code></pre></div>
<p><img src="p8_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="poisson-model-1">Poisson model<a class="anchor" aria-label="anchor" href="#poisson-model-1"></a>
</h3>
<p>Next, the analysis of the <em>Game of Thrones</em> data set will be considered and a Poisson model will be fitted:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inla.pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">Us</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Us <span class="op">=</span> <span class="va">Us</span><span class="op">)</span>, </span>
<span>  family <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">inla.pois</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in length(alist[[idx]]) &gt; 0 &amp;&amp; !is.null(alist[[idx]]) &amp;&amp; !</span></span>
<span><span class="co">## is.na(alist[[idx]]): 'length(x) = 4 &gt; 1' in coercion to 'logical(1)'</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">##    "inla(formula = Us ~ 1, family = \"poisson\", data = list(Us = Us))" </span></span>
<span><span class="co">## Time used:</span></span>
<span><span class="co">##     Pre = 1.42, Running = 0.135, Post = 0.102, Total = 1.66</span></span></code></pre>
<pre><code><span><span class="co">## Warning in length(alist[[idx]]) &gt; 0 &amp;&amp; !is.null(alist[[idx]]) &amp;&amp; !</span></span>
<span><span class="co">## is.na(alist[[idx]]): 'length(x) = 7 &gt; 1' in coercion to 'logical(1)'</span></span></code></pre>
<pre><code><span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##              mean    sd 0.025quant 0.5quant 0.975quant  mode kld</span></span>
<span><span class="co">## (Intercept) 3.247 0.039      3.169    3.248      3.324 3.248   0</span></span></code></pre>
<pre><code><span><span class="co">## Warning in length(alist[[idx]]) &gt; 0 &amp;&amp; !is.null(alist[[idx]]) &amp;&amp; !</span></span>
<span><span class="co">## is.na(alist[[idx]]): 'length(x) = 3 &gt; 1' in coercion to 'logical(1)'</span></span></code></pre>
<pre><code><span><span class="co">## Expected number of effective parameters(stdev): 1.00(0.00)</span></span>
<span><span class="co">## Number of equivalent replicates : 24.91</span></span></code></pre>
<pre><code><span><span class="co">## Warning in length(alist[[idx]]) &gt; 0 &amp;&amp; !is.null(alist[[idx]]) &amp;&amp; !</span></span>
<span><span class="co">## is.na(alist[[idx]]): 'length(x) = 2 &gt; 1' in coercion to 'logical(1)'</span></span></code></pre>
<pre><code><span><span class="co">## Marginal log-Likelihood:  -68.95</span></span></code></pre>
<p>Again, in order to obtain the posterior marginal distribution of the mean <span class="math inline">\(\lambda\)</span>, the marginal of <span class="math inline">\(\beta_0\)</span> needs to be transformed. In this case it is a bit simpler since <span class="math inline">\(\lambda = \exp(\beta_0)\)</span>:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">marg.lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span> <span class="op">(</span><span class="va">exp</span>, <span class="va">inla.pois</span><span class="op">$</span><span class="va">marginals.fixed</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> </span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">marg.lambda</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"Posterior density"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="st">"density"</span><span class="op">)</span></span></code></pre></div>
<p><img src="p8_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="normal-model-1">Normal model<a class="anchor" aria-label="anchor" href="#normal-model-1"></a>
</h3>
<p>Finally, the heights data set will be considered to fit a Bayesian model using a Gaussian likelihood with <code>INLA</code>:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inla.norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">heights</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>heights <span class="op">=</span> <span class="va">heights</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">inla.norm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in length(alist[[idx]]) &gt; 0 &amp;&amp; !is.null(alist[[idx]]) &amp;&amp; !</span></span>
<span><span class="co">## is.na(alist[[idx]]): 'length(x) = 4 &gt; 1' in coercion to 'logical(1)'</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">##    "inla(formula = heights ~ 1, family = \"gaussian\", data = list(heights </span></span>
<span><span class="co">##    = heights))" </span></span>
<span><span class="co">## Time used:</span></span>
<span><span class="co">##     Pre = 1.37, Running = 0.142, Post = 0.0938, Total = 1.6</span></span></code></pre>
<pre><code><span><span class="co">## Warning in length(alist[[idx]]) &gt; 0 &amp;&amp; !is.null(alist[[idx]]) &amp;&amp; !</span></span>
<span><span class="co">## is.na(alist[[idx]]): 'length(x) = 7 &gt; 1' in coercion to 'logical(1)'</span></span></code></pre>
<pre><code><span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##              mean    sd 0.025quant 0.5quant 0.975quant  mode kld</span></span>
<span><span class="co">## (Intercept) 1.716 0.023       1.67    1.716      1.763 1.716   0</span></span></code></pre>
<pre><code><span><span class="co">## Warning in length(alist[[idx]]) &gt; 0 &amp;&amp; !is.null(alist[[idx]]) &amp;&amp; !</span></span>
<span><span class="co">## is.na(alist[[idx]]): 'length(x) = 6 &gt; 1' in coercion to 'logical(1)'</span></span></code></pre>
<pre><code><span><span class="co">## Model hyperparameters:</span></span>
<span><span class="co">##                                          mean    sd 0.025quant 0.5quant</span></span>
<span><span class="co">## Precision for the Gaussian observations 64.59 16.41      36.55    63.20</span></span>
<span><span class="co">##                                         0.975quant  mode</span></span>
<span><span class="co">## Precision for the Gaussian observations     100.52 60.41</span></span></code></pre>
<pre><code><span><span class="co">## Warning in length(alist[[idx]]) &gt; 0 &amp;&amp; !is.null(alist[[idx]]) &amp;&amp; !</span></span>
<span><span class="co">## is.na(alist[[idx]]): 'length(x) = 3 &gt; 1' in coercion to 'logical(1)'</span></span></code></pre>
<pre><code><span><span class="co">## Expected number of effective parameters(stdev): 1.01(0.003)</span></span>
<span><span class="co">## Number of equivalent replicates : 29.66</span></span></code></pre>
<pre><code><span><span class="co">## Warning in length(alist[[idx]]) &gt; 0 &amp;&amp; !is.null(alist[[idx]]) &amp;&amp; !</span></span>
<span><span class="co">## is.na(alist[[idx]]): 'length(x) = 2 &gt; 1' in coercion to 'logical(1)'</span></span></code></pre>
<pre><code><span><span class="co">## Marginal log-Likelihood:  10.39</span></span></code></pre>
<p>As the mean <span class="math inline">\(\mu\)</span> is equal to the intercept <span class="math inline">\(\beta_0\)</span>, there is no need to make any transformation. Also, <code>INLA</code> provides an approximation to the model precision, so both marginals can be plotted straight away:</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">inla.norm</span><span class="op">$</span><span class="va">marginals.fixed</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"Posterior density"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="st">"density"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">inla.norm</span><span class="op">$</span><span class="va">marginals.hyperpar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"Posterior density"</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">400</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">tau</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="st">"density"</span><span class="op">)</span></span></code></pre></div>
<p><img src="p8_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by VIBASS4, Facundo MuÃ±oz.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

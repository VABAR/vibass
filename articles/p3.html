<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Practical 3: Bayesian linear regression • vibass</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Practical 3: Bayesian linear regression">
<meta property="og:description" content="vibass">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vibass</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.40</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/p1.html">Practical 1: Binary data</a>
    </li>
    <li>
      <a href="../articles/p2count.html">Practical 2: Count data</a>
    </li>
    <li>
      <a href="../articles/p2normal.html">Practical 2: Normal data</a>
    </li>
    <li>
      <a href="../articles/p3.html">Practical 3: Bayesian linear regression</a>
    </li>
    <li>
      <a href="../articles/p4.html">Practical 4: Simualtion-based Bayesian inference</a>
    </li>
    <li>
      <a href="../articles/p5.html">Practical 5: Numerical approaches</a>
    </li>
    <li>
      <a href="../articles/p6.html">Practical 6: Software and GLMs</a>
    </li>
    <li>
      <a href="../articles/p7.html">Practical 7: Bayesian Hierarchical Modelling</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/VABAR/vibass/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Practical 3: Bayesian linear regression</h1>
                        <h4 data-toc-skip class="author">VIBASS</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/VABAR/vibass/blob/HEAD/vignettes/p3.Rmd" class="external-link"><code>vignettes/p3.Rmd</code></a></small>
      <div class="hidden name"><code>p3.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="fitting-a-bayesian-spline-model">Fitting a Bayesian spline model<a class="anchor" aria-label="anchor" href="#fitting-a-bayesian-spline-model"></a>
</h2>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>The <code>Auto</code> dataset of the <code>ISLR</code> library
contains information on several characteristics of 392 vehicles.
Specifically, we will want to model the relationship between the
efficiency of these cars, measured as the number of miles they are able
to travel per gallon of fuel (variable <code>mpg</code>), and their
power, quantified by the variable <code>horsepower</code>.</p>
<p>We begin by visualizing the relationship between the two
variables</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Auto"</span>, package <span class="op">=</span> <span class="st">"ISLR"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">horsepower</span>, data <span class="op">=</span> <span class="va">Auto</span><span class="op">)</span></span></code></pre></div>
<p><img src="p3_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<p>The relationship between both variables is clearly nonlinear, so we
will fit a (Bayesian) spline regression model to this data set to
describe this relationship. As we have already mentioned in the theory,
spline models are just a particular case of linear models.</p>
</div>
<div class="section level3">
<h3 id="fitting-a-frequentist-spline-regression-model">Fitting a (frequentist) spline regression model<a class="anchor" aria-label="anchor" href="#fitting-a-frequentist-spline-regression-model"></a>
</h3>
<p>Spline regression models are linear models whose variables are the
elements of a basis of spline functions evaluated on each of the
individuals in the dataset. In our case, the explanatory variable with a
non linear relationship is <code>horsepower</code>. We define a basis of
spline functions (b-splines of degree 3) for this variable.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">splines</span><span class="op">)</span></span>
<span><span class="va">basis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/splines/bs.html" class="external-link">bs</a></span><span class="op">(</span><span class="va">Auto</span><span class="op">$</span><span class="va">horsepower</span>, df <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">Auto</span><span class="op">$</span><span class="va">horsepower</span><span class="op">)</span>,</span>
<span>  <span class="va">basis</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">Auto</span><span class="op">$</span><span class="va">horsepower</span><span class="op">)</span>, <span class="op">]</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'l'</span>, lty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Horsepower"</span>, ylab <span class="op">=</span> <span class="st">""</span>, </span>
<span>  main <span class="op">=</span> <span class="st">"B-spline basis of 5 elements"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="p3_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>A regression model with these functions would fit the complex
relationship between <code>mpg</code> and <code>horsepower</code> as a
linear combination of the 5 functions in this graph (and an intercept).
Let’s fit that relationship:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/splines/bs.html" class="external-link">bs</a></span><span class="op">(</span><span class="va">horsepower</span>, df <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">Auto</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">Fit1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = mpg ~ bs(horsepower, df = 5), data = Auto)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">## -15.7196  -2.6119  -0.2532   2.2002  15.3446 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                         Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)               33.024      1.712  19.290  &lt; 2e-16 ***</span></span>
<span><span class="co">## bs(horsepower, df = 5)1    5.682      2.611   2.176   0.0301 *  </span></span>
<span><span class="co">## bs(horsepower, df = 5)2   -8.368      1.740  -4.810 2.17e-06 ***</span></span>
<span><span class="co">## bs(horsepower, df = 5)3  -17.284      2.715  -6.366 5.53e-10 ***</span></span>
<span><span class="co">## bs(horsepower, df = 5)4  -23.210      2.956  -7.852 4.10e-14 ***</span></span>
<span><span class="co">## bs(horsepower, df = 5)5  -18.937      2.694  -7.029 9.49e-12 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 4.29 on 386 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.7017, Adjusted R-squared:  0.6979 </span></span>
<span><span class="co">## F-statistic: 181.6 on 5 and 386 DF,  p-value: &lt; 2.2e-16</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">horsepower</span>, data <span class="op">=</span> <span class="va">Auto</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fl">46</span><span class="op">:</span><span class="fl">230</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">Fit1</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>horsepower <span class="op">=</span> <span class="fl">46</span><span class="op">:</span><span class="fl">230</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      col <span class="op">=</span> <span class="st">'red'</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="p3_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>The fitted curve adequately describes the relationship between both
variables. Moreover, all elements of the spline basis seem to have a
significant effect, that is, all of them are necessary to describe the
differences between the intercept (expected value for the lowest power)
and the <code>mpg</code>s for higher <code>horsepower</code>s.</p>
</div>
<div class="section level3">
<h3 id="fitting-a-bayesian-spline-regression-model">Fitting a Bayesian spline regression model<a class="anchor" aria-label="anchor" href="#fitting-a-bayesian-spline-regression-model"></a>
</h3>
<p>Let us now fit the Bayesian version of the above model. We will use,
for convenience, Jeffreys’ prior for <span class="math inline">\(\pi(\boldsymbol{\beta},\,\sigma^2)\propto
\sigma^{-2}\)</span>. In that case, the posterior residual variance is:
<span class="math display">\[\sigma^2\mid \mathcal{D}\sim
\text{IG}\Big(\sigma^2\mid\big((n-(p+1)\big)/2,\, s_e^2/2\Big),\]</span>
where <span class="math inline">\(n\)</span> is the sample size, <span class="math inline">\(p\)</span> is the number of model parameters and
<span class="math inline">\(s_e^2\)</span> is the sum of squared
residuals.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LaplacesDemonR/LaplacesDemon" class="external-link">LaplacesDemon</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/LaplacesDemon/man/dist.Inverse.Gamma.html" class="external-link">dinvgamma</a></span><span class="op">(</span><span class="va">x</span>, <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Auto</span><span class="op">)</span> <span class="op">-</span> <span class="fl">6</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">Fit1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>, </span>
<span>  col <span class="op">=</span> <span class="st">"darkgreen"</span>, lwd <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>, <span class="fl">25</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Residual variance "</span>, <span class="va">sigma</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">'posterior density'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="p3_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>This distribution yields a posterior mean of <span class="math inline">\((s^2_e/2)/((n-(p+1))/2-1)\)</span> and a mode of
<span class="math inline">\((s^2_e/2)/((n-(p+1))/2+1)\)</span>, that
is:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Estimator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Posterior mean'</span>, <span class="st">'Posterior mode'</span>, <span class="st">'Maximum-likelihood'</span><span class="op">)</span>,</span>
<span>  Value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">Fit1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">/</span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Auto</span><span class="op">)</span><span class="op">-</span><span class="fl">6</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">Fit1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">/</span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Auto</span><span class="op">)</span><span class="op">-</span><span class="fl">6</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Fit1</span><span class="op">$</span><span class="va">residuals</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Auto</span><span class="op">)</span><span class="op">-</span><span class="fl">6</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Estimator</th>
<th align="right">Value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Posterior mean</td>
<td align="right">18.50</td>
</tr>
<tr class="even">
<td align="left">Posterior mode</td>
<td align="right">18.31</td>
</tr>
<tr class="odd">
<td align="left">Maximum-likelihood</td>
<td align="right">18.41</td>
</tr>
</tbody>
</table>
<p>The posterior point estimates are quite close to the frequentist
estimate, although the posterior distribution of <span class="math inline">\(\sigma^2\mid\mathcal{D}\)</span> allows, in
addition, to explore the uncertainty of this parameter.</p>
<p>As mentioned in the theoretical session, <span class="math inline">\(\boldsymbol{\beta}\)</span> has the following
marginal posterior distribution: <span class="math display">\[\pi(\boldsymbol{\beta}\mid \mathcal{D})\sim
t_{n-(p+1)}\Big(\hat{\boldsymbol{\beta}},\,s_e^2(\boldsymbol{X}'\boldsymbol{X})^{-1}/(n-(p+1)\Big)\]</span>
The mean of this multivariate distribution coincides with the
coefficients of the linear model <code>Fit1</code>, and has as
variance-covariance matrix:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">basis</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="va">basis</span><span class="op">)</span></span>
<span><span class="va">VarCov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">X</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">Fit1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Auto</span><span class="op">)</span><span class="op">-</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">VarCov</span></span></code></pre></div>
<pre><code><span><span class="co">##                     1         2         3          4          5</span></span>
<span><span class="co">##    2.930920 -3.990558 -2.557275 -3.452341 -2.4105262 -3.1068632</span></span>
<span><span class="co">## 1 -3.990558  6.816592  2.782554  5.738656  2.2225789  4.5917747</span></span>
<span><span class="co">## 2 -2.557275  2.782554  3.026389  1.679175  3.5176276  2.2200446</span></span>
<span><span class="co">## 3 -3.452341  5.738656  1.679175  7.372808 -1.0082916  5.0428402</span></span>
<span><span class="co">## 4 -2.410526  2.222579  3.517628 -1.008292  8.7383010 -0.4500045</span></span>
<span><span class="co">## 5 -3.106863  4.591775  2.220045  5.042840 -0.4500045  7.2588354</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Correlation between coefficients</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov2cor</a></span><span class="op">(</span><span class="va">VarCov</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                       1          2          3           4           5</span></span>
<span><span class="co">##    1.0000000 -0.8927874 -0.8586440 -0.7426690 -0.47631730 -0.67357610</span></span>
<span><span class="co">## 1 -0.8927874  1.0000000  0.6126290  0.8094874  0.28797850  0.65277493</span></span>
<span><span class="co">## 2 -0.8586440  0.6126290  1.0000000  0.3554817  0.68402820  0.47365908</span></span>
<span><span class="co">## 3 -0.7426690  0.8094874  0.3554817  1.0000000 -0.12561924  0.68932697</span></span>
<span><span class="co">## 4 -0.4763173  0.2879785  0.6840282 -0.1256192  1.00000000 -0.05650279</span></span>
<span><span class="co">## 5 -0.6735761  0.6527749  0.4736591  0.6893270 -0.05650279  1.00000000</span></span></code></pre>
<p>Moreover, we can also plot the bivariate distribution for each pair
of these coefficients:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Define a helper function that yields a vector of values for</span></span>
<span><span class="co">## the evaluation of the posterior distribution of a coefficient x</span></span>
<span><span class="va">post_support</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span></span>
<span>  <span class="va">Fit1</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">-</span><span class="fl">3</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">VarCov</span><span class="op">[</span><span class="va">x</span>,<span class="va">x</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="va">Fit1</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">+</span><span class="fl">3</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">VarCov</span><span class="op">[</span><span class="va">x</span>,<span class="va">x</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the intercept and first component of the spline</span></span>
<span><span class="va">xvalues</span> <span class="op">&lt;-</span> <span class="fu">post_support</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">yvalues</span> <span class="op">&lt;-</span> <span class="fu">post_support</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">gridPoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span><span class="va">xvalues</span>, <span class="va">yvalues</span><span class="op">)</span></span>
<span><span class="va">resul</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/LaplacesDemon/man/dist.Multivariate.t.html" class="external-link">dmvt</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">gridPoints</span><span class="op">)</span>,</span>
<span>    mu <span class="op">=</span> <span class="va">Fit1</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    S <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">VarCov</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">5</span><span class="op">)</span>, </span>
<span>    df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Auto</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="fl">5</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xvalues</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">xvalues</span>, y <span class="op">=</span> <span class="va">yvalues</span>, z <span class="op">=</span> <span class="va">resul</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Intercept"</span>, ylab <span class="op">=</span> <span class="st">"beta, first component of the basis"</span>, </span>
<span>  main <span class="op">=</span> <span class="st">"Bivariate posterior density"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="p3_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>That is, if the intercept were to take higher values, it would be
compensated by the first component of the basis, which would take lower
values.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the first and third component of the spline</span></span>
<span><span class="va">xvalues</span> <span class="op">&lt;-</span> <span class="fu">post_support</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">yvalues</span> <span class="op">&lt;-</span> <span class="fu">post_support</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">gridPoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span><span class="va">xvalues</span>, <span class="va">yvalues</span><span class="op">)</span></span>
<span><span class="va">resul</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/LaplacesDemon/man/dist.Multivariate.t.html" class="external-link">dmvt</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">gridPoints</span><span class="op">)</span>,</span>
<span>    mu <span class="op">=</span> <span class="va">Fit1</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    S <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">VarCov</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>, <span class="fl">5</span><span class="op">)</span>, </span>
<span>    df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Auto</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="fl">5</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xvalues</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">xvalues</span>, y <span class="op">=</span> <span class="va">yvalues</span>, z <span class="op">=</span> <span class="va">resul</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"beta, first component of the basis"</span>, </span>
<span>  ylab <span class="op">=</span> <span class="st">"beta, third component of the basis"</span>, </span>
<span>  main <span class="op">=</span> <span class="st">"Bivariate posterior density"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="p3_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>The opposite is true for the first and third components of the
spline, since high values of one of the coefficients are accompanied by
high values of the other.</p>
<p>Furthermore, we can also quantify the probability that each of the
components is positive:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/pkg/LaplacesDemon/man/dist.Student.t.html" class="external-link">pst</a></span><span class="op">(</span></span>
<span>  <span class="fl">0</span>,</span>
<span>  mu <span class="op">=</span> <span class="va">Fit1</span><span class="op">$</span><span class="va">coefficients</span>, sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">VarCov</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  nu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Auto</span><span class="op">)</span><span class="op">-</span><span class="op">(</span><span class="fl">5</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1.000000e+00 9.849294e-01 1.083615e-06 2.762574e-10 2.042810e-14</span></span>
<span><span class="co">## [6] 4.745981e-12</span></span></code></pre>
<p>These probabilities may be used as Bayesian measures of evidence of
the contribution of each variable to the fit. Values of these
probabilities close to 0 or 1 indicate the appropriateness of
considering that component in the model.</p>
<p>Finally, the posterior means of the components of <span class="math inline">\(\boldsymbol{\beta}\)</span> coincide with the
frequentist estimates of those same coefficients. Therefore, the point
estimate (posterior mean) of the spline curve resulting from the
Bayesian analysis exactly matches the corresponding curve from the
frequentist analysis.</p>
</div>
</div>
<div class="section level2">
<h2 id="time-to-individual-work">Time to individual work<a class="anchor" aria-label="anchor" href="#time-to-individual-work"></a>
</h2>
<p>We propose below an individual exercise that pursues to consolidate
the basic concepts that we have learned in the previous theoretical
session and that we have been practising in this session.</p>
<p><strong>Exercice</strong></p>
<p>The data set <code>Weights</code>, included in the
<code>VIBASS</code> package, is the data set used for the example of the
theoretical session. That data set has a categorical variable,
<code>ethnicity</code>, which contains the ethnicity of each of the
children in the study. Fit a Bayesian linear regression model (ANCOVA)
that explains each child’s weight as a function of age, ethnicity and
the interaction of these factors. Explore the posterior distribution of
the coefficients in the model and evaluate the need for each of these
factors within the regression model.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by VIBASS5, Facundo Muñoz.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
